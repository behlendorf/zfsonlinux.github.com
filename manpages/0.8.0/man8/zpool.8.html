<HTML><HEAD><TITLE>Manpage of ZPOOL</TITLE>
</HEAD><BODY>
<H1>ZPOOL</H1>
Section: Maintenance Commands (8)<BR>Updated: May 2, 2019<BR>
<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DL>
<DT><A HREF="#lbAE">Virtual Devices (vdevs)</A><DD>
<DT><A HREF="#lbAF">Device Failure and Recovery</A><DD>
<DT><A HREF="#lbAG">Hot Spares</A><DD>
<DT><A HREF="#lbAH">Intent Log</A><DD>
<DT><A HREF="#lbAI">Cache Devices</A><DD>
<DT><A HREF="#lbAJ">Pool checkpoint</A><DD>
<DT><A HREF="#lbAK">Special Allocation Class</A><DD>
<DT><A HREF="#lbAL">Properties</A><DD>
<DT><A HREF="#lbAM">Subcommands</A><DD>
</DL>
<DT><A HREF="#lbAN">EXIT STATUS</A><DD>
<DT><A HREF="#lbAO">EXAMPLES</A><DD>
<DT><A HREF="#lbAP">ENVIRONMENT VARIABLES</A><DD>
<DT><A HREF="#lbAQ">INTERFACE STABILITY</A><DD>
<DT><A HREF="#lbAR">SEE ALSO</A><DD>
</DL>
<HR>
<A HREF="../index.html">Return to Main Contents</A><HR>
<BR>BSD mandoc<BR>
Linux

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

<B>zpool</B>

 - configure ZFS storage pools

<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<B></B>


-<B>?V</B>

<BR><B></B>


<B>add</B>

[-<B>fgLnP</B>

]

[-<B>o </B><I>property </I><B>= </B><I>value </I>]











<I>pool vdev </I><B>...</B>



<BR><B></B>


<B>attach</B>

[-<B>f</B>

]

[-<B>o </B><I>property </I><B>= </B><I>value </I>]











<I>pool device new_device</I>

<BR><B></B>


<B>checkpoint</B>

[-<B>d, -discard</B>

]

<I>pool</I>

<BR><B></B>


<B>clear</B>

<I>pool</I>

[<I>device</I>

]

<BR><B></B>


<B>create</B>

[-<B>dfn</B>

]

[-<B>m </B><I>mountpoint</I>



]

[-<B>o </B><I>property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>o </B><I>feature@feature </I><B>= </B><I>value </I>]











[-<B>O </B><I>file-system-property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>R </B><I>root</I>



]

<I>pool vdev </I><B>...</B>



<BR><B></B>


<B>destroy</B>

[-<B>f</B>

]

<I>pool</I>

<BR><B></B>


<B>detach</B>

<I>pool device</I>

<BR><B></B>


<B>events</B>

[-<B>vHf </B>[<I>pool | -</I><B>c</B>

]







]

<BR><B></B>


<B>export</B>

[-<B>a</B>

]

[-<B>f</B>

]

<I>pool </I><B>...</B>



<BR><B></B>


<B>get</B>

[-<B>Hp </B>[-<B>o </B><I>field </I><B></B>[, <B></B><I>field </I><B>...</B>

]











]





]

<B>all | </B><I>property </I><B></B>[, <B></B><I>property </I><B>...</B>

]















[<I>pool </I><B>...</B>

]



<BR><B></B>


<B>history</B>

[-<B>il</B>

]

[<I>pool </I><B>...</B>

]



<BR><B></B>


<B>import</B>

[-<B>D</B>

]

[-<B>d </B><I>dir </I><B>| device</B>







]

<BR><B></B>


<B>import</B>

-<B>a</B>

[-<B>DflmN</B>

]

[-<B>F </B>[-<B>n </B>[-<B>T </B>[-<B>X </B>]



]



]





]

[-<B>-rewind-to-checkpoint</B>

]

[-<B>c </B><I>cachefile </I><B>| -d </B><I>dir </I><B>| device</B>















]

[-<B>o </B><I>mntopts</I>



]

[-<B>o </B><I>property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>R </B><I>root</I>



]

<BR><B></B>


<B>import</B>

[-<B>Dflm</B>

]

[-<B>F </B>[-<B>n </B>[-<B>T </B>[-<B>X </B>]



]



]





]

[-<B>-rewind-to-checkpoint</B>

]

[-<B>c </B><I>cachefile </I><B>| -d </B><I>dir </I><B>| device</B>















]

[-<B>o </B><I>mntopts</I>



]

[-<B>o </B><I>property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>R </B><I>root</I>



]

[-<B>s</B>

]

<I>pool </I><B>| </B><I>id</I>







[<I>newpool </I>[-<B>t </B>]





]

<BR><B></B>


<B>initialize</B>

[-<B>c | -s</B>



]

<I>pool</I>

[<I>device </I><B>...</B>



]

<BR><B></B>


<B>iostat</B>

[[[-<B>c </B><I>SCRIPT </I>[-<B>lq | -rw</B>





]
]



]






]

[-<B>T u | d</B>









]

[-<B>ghHLnpPvy</B>

]

[[<I>pool </I><B>... | </B>[<I>pool vdev </I><B>... | </B>[<I>vdev </I><B>... </B>]
]









]









]






[<I>interval </I>[<I>count</I>

]



]

<BR><B></B>


<B>labelclear</B>

[-<B>f</B>

]

<I>device</I>

<BR><B></B>


<B>list</B>

[-<B>HgLpPv </B>[-<B>o </B><I>property </I><B></B>[, <B></B><I>property </I><B>...</B>

]











]





]

[-<B>T u | d</B>









]

[<I>pool </I><B>...</B>

]



[<I>interval </I>[<I>count</I>

]



]

<BR><B></B>


<B>offline</B>

[-<B>f</B>

]

[-<B>t</B>

]

<I>pool device </I><B>...</B>





<BR><B></B>


<B>online</B>

[-<B>e</B>

]

<I>pool device </I><B>...</B>





<BR><B></B>


<B>reguid</B>

<I>pool</I>

<BR><B></B>


<B>reopen</B>

[-<B>n</B>

]

<I>pool</I>

<BR><B></B>


<B>remove</B>

[-<B>np</B>

]

<I>pool device </I><B>...</B>





<BR><B></B>


<B>remove</B>

-<B>s</B>

<I>pool</I>

<BR><B></B>


<B>replace</B>

[-<B>f</B>

]

[-<B>o </B><I>property </I><B>= </B><I>value </I>]











<I>pool device </I>[<I>new_device</I>

]





<BR><B></B>


<B>resilver</B>

<I>pool </I><B>...</B>



<BR><B></B>


<B>scrub</B>

[-<B>s | -p</B>



]

<I>pool </I><B>...</B>



<BR><B></B>


<B>trim</B>

[-<B>d</B>

]

[-<B>r </B><I>rate</I>



]

[-<B>c | -s</B>



]

<I>pool</I>

[<I>device </I><B>...</B>



]

<BR><B></B>


<B>set</B>

<I>property </I><B>= </B><I>value</I>







<I>pool</I>

<BR><B></B>


<B>split</B>

[-<B>gLlnP</B>

]

[-<B>o </B><I>property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>R </B><I>root</I>



]

<I>pool newpool</I>

[<I>device </I><B>...</B>

]



<BR><B></B>


<B>status</B>

[-<B>c </B><I>SCRIPT </I>]





[-<B>DigLpPstvx</B>

]

[-<B>T u | d</B>









]

[<I>pool </I><B>...</B>

]



[<I>interval </I>[<I>count</I>

]



]

<BR><B></B>


<B>sync</B>

[<I>pool </I><B>...</B>

]



<BR><B></B>


<B>upgrade</B>

<BR><B></B>


<B>upgrade</B>

-<B>v</B>

<BR><B></B>


<B>upgrade</B>

[-<B>V </B><I>version</I>



]

-<B>a | </B><I>pool </I><B>...</B>









<BR><B></B>


<B>version</B>

<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

The
<B></B>


command configures ZFS storage pools.
A storage pool is a collection of devices that provides physical storage and
data replication for ZFS datasets.
All datasets within a storage pool share the same space.
See
<A HREF="../man8/zfs.8.html">zfs</A>(8)


for information on managing datasets.
<A NAME="lbAE">&nbsp;</A>
<H3>Virtual Devices (vdevs)</H3>

A &quot;virtual device&quot; describes a single device or a collection of devices
organized according to certain performance and fault characteristics.
The following virtual devices are supported:
<DL COMPACT>
<P>

<DT><B>disk</B>


<DD>
A block device, typically located under
/dev

 
ZFS can use individual slices or partitions, though the recommended mode of
operation is to use whole disks.
A disk can be specified by a full path, or it can be a shorthand name
Po the relative portion of the path under

/dev

Pc .

A whole disk can be specified by omitting the slice or partition designation.
For example,
sda

is equivalent to
/dev/sda

 
When given a whole disk, ZFS automatically labels the disk, if necessary.
<DT><B>file</B>


<DD>
A regular file.
The use of files as a backing store is strongly discouraged.
It is designed primarily for experimental purposes, as the fault tolerance of a
file is only as good as the file system of which it is a part.
A file must be specified by a full path.
<DT><B>mirror</B>


<DD>
A mirror of two or more devices.
Data is replicated in an identical fashion across all components of a mirror.
A mirror with N disks of size X can hold X bytes and can withstand (N-1) devices
failing before data integrity is compromised.
<DT><B>raidz , raidz1 , raidz2 , raidz3</B>


<DD>
A variation on RAID-5 that allows for better distribution of parity and
eliminates the RAID-5
Qq write hole

(in which data and parity become inconsistent after a power loss)

 
Data and parity is striped across all disks within a raidz group.
<P>

A raidz group can have single-, double-, or triple-parity, meaning that the
raidz group can sustain one, two, or three failures, respectively, without
losing any data.
The
<B>raidz1</B>

vdev type specifies a single-parity raidz group; the
<B>raidz2</B>

vdev type specifies a double-parity raidz group; and the
<B>raidz3</B>

vdev type specifies a triple-parity raidz group.
The
<B>raidz</B>

vdev type is an alias for
<B>raidz1</B>

 
<P>

A raidz group with N disks of size X with P parity disks can hold approximately
(N-P)*X bytes and can withstand P device(s) failing before data integrity is
compromised.
The minimum number of devices in a raidz group is one more than the number of
parity disks.
The recommended number is between 3 and 9 to help increase performance.
<DT><B>spare</B>


<DD>
A pseudo-vdev which keeps track of available hot spares for a pool.
For more information, see the
Sx Hot Spares

section.
<DT><B>log</B>


<DD>
A separate intent log device.
If more than one log device is specified, then writes are load-balanced between
devices.
Log devices can be mirrored.
However, raidz vdev types are not supported for the intent log.
For more information, see the
Sx Intent Log

section.
<DT><B>dedup</B>


<DD>
A device dedicated solely for deduplication tables.
The redundancy of this device should match the redundancy of the other normal
devices in the pool. If more than one dedup device is specified, then
allocations are load-balanced between those devices.
<DT><B>special</B>


<DD>
A device dedicated solely for allocating various kinds of internal metadata,
and optionally small file blocks.
The redundancy of this device should match the redundancy of the other normal
devices in the pool. If more than one special device is specified, then
allocations are load-balanced between those devices.
<P>

For more information on special allocations, see the
Sx Special Allocation Class

section.
<DT><B>cache</B>


<DD>
A device used to cache storage pool data.
A cache device cannot be configured as a mirror or raidz group.
For more information, see the
Sx Cache Devices

section.
</DL>
<P>

<P>

Virtual devices cannot be nested, so a mirror or raidz virtual device can only
contain files or disks.
Mirrors of mirrors
(or other combinations)

are not allowed.
<P>

A pool can have any number of virtual devices at the top of the configuration
Po known as

Qq root vdevs

Pc .

Data is dynamically distributed across all top-level devices to balance data
among devices.
As new virtual devices are added, ZFS automatically places data on the newly
available devices.
<P>

Virtual devices are specified one at a time on the command line, separated by
whitespace.
The keywords
<B>mirror</B>

and
<B>raidz</B>

are used to distinguish where a group ends and another begins.
For example, the following creates two root vdevs, each a mirror of two disks:

<PRE>
# zpool create mypool mirror sda sdb mirror sdc sdd
</PRE>

<A NAME="lbAF">&nbsp;</A>
<H3>Device Failure and Recovery</H3>

ZFS supports a rich set of mechanisms for handling device failure and data
corruption.
All metadata and data is checksummed, and ZFS automatically repairs bad data
from a good copy when corruption is detected.
<P>

In order to take advantage of these features, a pool must make use of some form
of redundancy, using either mirrored or raidz groups.
While ZFS supports running in a non-redundant configuration, where each root
vdev is simply a disk or file, this is strongly discouraged.
A single case of bit corruption can render some or all of your data unavailable.
<P>

A pool's health status is described by one of three states: online, degraded,
or faulted.
An online pool has all devices operating normally.
A degraded pool is one in which one or more devices have failed, but the data is
still available due to a redundant configuration.
A faulted pool has corrupted metadata, or one or more faulted devices, and
insufficient replicas to continue functioning.
<P>

The health of the top-level vdev, such as mirror or raidz device, is
potentially impacted by the state of its associated vdevs, or component
devices.
A top-level vdev or component device is in one of the following states:
<DL COMPACT>
<P>

<DT><B>DEGRADED</B>


<DD>
One or more top-level vdevs is in the degraded state because one or more
component devices are offline.
Sufficient replicas exist to continue functioning.
<P>

One or more component devices is in the degraded or faulted state, but
sufficient replicas exist to continue functioning.
The underlying conditions are as follows:
<UL><P>

<LI>

The number of checksum errors exceeds acceptable levels and the device is
degraded as an indication that something may be wrong.
ZFS continues to use the device as necessary.
<LI>

The number of I/O errors exceeds acceptable levels.
The device could not be marked as faulted because there are insufficient
replicas to continue functioning.
</UL><P>

<DT><B>FAULTED</B>


<DD>
One or more top-level vdevs is in the faulted state because one or more
component devices are offline.
Insufficient replicas exist to continue functioning.
<P>

One or more component devices is in the faulted state, and insufficient
replicas exist to continue functioning.
The underlying conditions are as follows:
<UL><P>

<LI>

The device could be opened, but the contents did not match expected values.
<LI>

The number of I/O errors exceeds acceptable levels and the device is faulted to
prevent further use of the device.
</UL><P>

<DT><B>OFFLINE</B>


<DD>
The device was explicitly taken offline by the
<B>zpool offline</B>



command.
<DT><B>ONLINE</B>


<DD>
The device is online and functioning.
<DT><B>REMOVED</B>


<DD>
The device was physically removed while the system was running.
Device removal detection is hardware-dependent and may not be supported on all
platforms.
<DT><B>UNAVAIL</B>


<DD>
The device could not be opened.
If a pool is imported when a device was unavailable, then the device will be
identified by a unique identifier instead of its path since the path was never
correct in the first place.
</DL>
<P>

<P>

If a device is removed and later re-attached to the system, ZFS attempts
to put the device online automatically.
Device attach detection is hardware-dependent and might not be supported on all
platforms.
<A NAME="lbAG">&nbsp;</A>
<H3>Hot Spares</H3>

ZFS allows devices to be associated with pools as
Qq hot spares .

These devices are not actively used in the pool, but when an active device
fails, it is automatically replaced by a hot spare.
To create a pool with hot spares, specify a
<B>spare</B>

vdev with any number of devices.
For example,

<PRE>
# zpool create pool mirror sda sdb spare sdc sdd
</PRE>

<P>

Spares can be shared across multiple pools, and can be added with the
<B>zpool add</B>



command and removed with the
<B>zpool remove</B>



command.
Once a spare replacement is initiated, a new
<B>spare</B>

vdev is created within the configuration that will remain there until the
original device is replaced.
At this point, the hot spare becomes available again if another device fails.
<P>

If a pool has a shared spare that is currently being used, the pool can not be
exported since other pools may use this shared spare, which may lead to
potential data corruption.
<P>

Shared spares add some risk.  If the pools are imported on different hosts, and
both pools suffer a device failure at the same time, both could attempt to use
the spare at the same time.  This may not be detected, resulting in data
corruption.
<P>

An in-progress spare replacement can be cancelled by detaching the hot spare.
If the original faulted device is detached, then the hot spare assumes its
place in the configuration, and is removed from the spare list of all active
pools.
<P>

Spares cannot replace log devices.
<A NAME="lbAH">&nbsp;</A>
<H3>Intent Log</H3>

The ZFS Intent Log (ZIL) satisfies POSIX requirements for synchronous
transactions.
For instance, databases often require their transactions to be on stable storage
devices when returning from a system call.
NFS and other applications can also use
<A HREF="../man2/fsync.2.html">fsync</A>(2)


to ensure data stability.
By default, the intent log is allocated from blocks within the main pool.
However, it might be possible to get better performance using separate intent
log devices such as NVRAM or a dedicated disk.
For example:

<PRE>
# zpool create pool sda sdb log sdc
</PRE>

<P>

Multiple log devices can also be specified, and they can be mirrored.
See the
Sx EXAMPLES

section for an example of mirroring multiple log devices.
<P>

Log devices can be added, replaced, attached, detached and removed.  In
addition, log devices are imported and exported as part of the pool
that contains them.
Mirrored devices can be removed by specifying the top-level mirror vdev.
<A NAME="lbAI">&nbsp;</A>
<H3>Cache Devices</H3>

Devices can be added to a storage pool as
Qq cache devices .

These devices provide an additional layer of caching between main memory and
disk.
For read-heavy workloads, where the working set size is much larger than what
can be cached in main memory, using cache devices allow much more of this
working set to be served from low latency media.
Using cache devices provides the greatest performance improvement for random
read-workloads of mostly static content.
<P>

To create a pool with cache devices, specify a
<B>cache</B>

vdev with any number of devices.
For example:

<PRE>
# zpool create pool sda sdb cache sdc sdd
</PRE>

<P>

Cache devices cannot be mirrored or part of a raidz configuration.
If a read error is encountered on a cache device, that read I/O is reissued to
the original storage pool device, which might be part of a mirrored or raidz
configuration.
<P>

The content of the cache devices is considered volatile, as is the case with
other system caches.
<A NAME="lbAJ">&nbsp;</A>
<H3>Pool checkpoint</H3>

Before starting critical procedures that include destructive actions (e.g
<B>zfs destroy</B>



), an administrator can checkpoint the pool's state and in the case of a
mistake or failure, rewind the entire pool back to the checkpoint.
Otherwise, the checkpoint can be discarded when the procedure has completed
successfully.
<P>

A pool checkpoint can be thought of as a pool-wide snapshot and should be used
with care as it contains every part of the pool's state, from properties to vdev
configuration.
Thus, while a pool has a checkpoint certain operations are not allowed.
Specifically, vdev removal/attach/detach, mirror splitting, and
changing the pool's guid.
Adding a new vdev is supported but in the case of a rewind it will have to be
added again.
Finally, users of this feature should keep in mind that scrubs in a pool that
has a checkpoint do not repair checkpointed data.
<P>

To create a checkpoint for a pool:

<PRE>
# zpool checkpoint pool
</PRE>

<P>

To later rewind to its checkpointed state, you need to first export it and
then rewind it during import:

<PRE>
# zpool export pool
# zpool import --rewind-to-checkpoint pool
</PRE>

<P>

To discard the checkpoint from a pool:

<PRE>
# zpool checkpoint -d pool
</PRE>

<P>

Dataset reservations (controlled by the
<B>reservation</B>

or
<B>refreservation</B>

zfs properties) may be unenforceable while a checkpoint exists, because the
checkpoint is allowed to consume the dataset's reservation.
Finally, data that is part of the checkpoint but has been freed in the
current state of the pool won't be scanned during a scrub.
<A NAME="lbAK">&nbsp;</A>
<H3>Special Allocation Class</H3>

The allocations in the special class are dedicated to specific block types.
By default this includes all metadata, the indirect blocks of user data, and
any deduplication tables.  The class can also be provisioned to accept
small file blocks.
<P>

A pool must always have at least one normal (non-dedup/special) vdev before
other devices can be assigned to the special class. If the special class
becomes full, then allocations intended for it will spill back into the
normal class.
<P>

Deduplication tables can be excluded from the special class by setting the
<B>zfs_ddt_data_is_special</B>

zfs module parameter to false (0).
<P>

Inclusion of small file blocks in the special class is opt-in. Each dataset
can control the size of small file blocks allowed in the special class by
setting the
<B>special_small_blocks</B>

dataset property. It defaults to zero, so you must opt-in by setting it to a
non-zero value. See
<A HREF="../man8/zfs.8.html">zfs</A>(8)


for more info on setting this property.
<A NAME="lbAL">&nbsp;</A>
<H3>Properties</H3>

Each pool has several properties associated with it.
Some properties are read-only statistics while others are configurable and
change the behavior of the pool.
<P>

The following are read-only properties:
<DL COMPACT>
<P>

<DT><B>allocated</B>


<DD>
Amount of storage used within the pool.
See
<B>fragmentation</B>

and
<B>free</B>

for more information.
<DT><B>capacity</B>


<DD>
Percentage of pool space used.
This property can also be referred to by its shortened column name,
<B>cap</B>

 
<DT><B>expandsize</B>


<DD>
Amount of uninitialized space within the pool or device that can be used to
increase the total capacity of the pool.
Uninitialized space consists of any space on an EFI labeled vdev which has not
been brought online
Po e.g, using

<B>zpool online -e</B>





Pc .

This space occurs when a LUN is dynamically expanded.
<DT><B>fragmentation</B>


<DD>
The amount of fragmentation in the pool. As the amount of space
<B>allocated</B>

increases, it becomes more difficult to locate
<B>free</B>

space. This may result in lower write performance compared to pools with more
unfragmented free space.
<DT><B>free</B>


<DD>
The amount of free space available in the pool.
By contrast, the
<A HREF="../man8/zfs.8.html">zfs</A>(8)


<B>available</B>

property describes how much new data can be written to ZFS filesystems/volumes.
The zpool
<B>free</B>

property is not generally useful for this purpose, and can be substantially more than the zfs
<B>available</B>

space. This discrepancy is due to several factors, including raidz party; zfs
reservation, quota, refreservation, and refquota properties; and space set aside by
<B>spa_slop_shift</B>

(see
zfs-module-parameters5


for more information).
<DT><B>freeing</B>


<DD>
After a file system or snapshot is destroyed, the space it was using is
returned to the pool asynchronously.
<B>freeing</B>

is the amount of space remaining to be reclaimed.
Over time
<B>freeing</B>

will decrease while
<B>free</B>

increases.
<DT><B>health</B>


<DD>
The current health of the pool.
Health can be one of
<B>ONLINE , DEGRADED , FAULTED , OFFLINE, REMOVED , UNAVAIL</B>

 
<DT><B>guid</B>


<DD>
A unique identifier for the pool.
<DT><B>load_guid</B>


<DD>
A unique identifier for the pool.
Unlike the
<B>guid</B>

property, this identifier is generated every time we load the pool (e.g. does
not persist across imports/exports) and never changes while the pool is loaded
(even if a
<B>reguid</B>

operation takes place).
<DT><B>size</B>


<DD>
Total size of the storage pool.
<DT><B>unsupported@ </B><I>feature_guid</I>






<DD>
Information about unsupported features that are enabled on the pool.
See
zpool-features5


for details.
</DL>
<P>

<P>

The space usage properties report actual physical space available to the
storage pool.
The physical space can be different from the total amount of space that any
contained datasets can actually use.
The amount of space used in a raidz configuration depends on the characteristics
of the data being written.
In addition, ZFS reserves some space for internal accounting that the
<A HREF="../man8/zfs.8.html">zfs</A>(8)


command takes into account, but the
<B></B>


command does not.
For non-full pools of a reasonable size, these effects should be invisible.
For small pools, or pools that are close to being completely full, these
discrepancies may become more noticeable.
<P>

The following property can be set at creation time and import time:
<DL COMPACT>
<P>

<DT><B>altroot</B>


<DD>
Alternate root directory.
If set, this directory is prepended to any mount points within the pool.
This can be used when examining an unknown pool where the mount points cannot be
trusted, or in an alternate boot environment, where the typical paths are not
valid.
<B>altroot</B>

is not a persistent property.
It is valid only while the system is up.
Setting
<B>altroot</B>

defaults to using
<B>cachefile = none</B>







 
though this may be overridden using an explicit setting.
</DL>
<P>

<P>

The following property can be set only at import time:
<DL COMPACT>
<P>

<DT><B>readonly = on | off</B>














<DD>
If set to
<B>on</B>

 
the pool will be imported in read-only mode.
This property can also be referred to by its shortened column name,
<B>rdonly</B>

 
</DL>
<P>

<P>

The following properties can be set at creation time and import time, and later
changed with the
<B>zpool set</B>



command:
<DL COMPACT>
<P>

<DT><B>ashift = ashift</B>








<DD>
Pool sector size exponent, to the power of
<B>2</B>

(internally referred to as
<B>ashift</B>

). Values from 9 to 16, inclusive, are valid; also, the
value 0 (the default) means to auto-detect using the kernel's block
layer and a ZFS internal exception list. I/O operations will be aligned
to the specified size boundaries. Additionally, the minimum (disk)
write size will be set to the specified size, so this represents a
space vs. performance trade-off. For optimal performance, the pool
sector size should be greater than or equal to the sector size of the
underlying disks. The typical case for setting this property is when
performance is important and the underlying disks use 4KiB sectors but
report 512B sectors to the OS (for compatibility reasons); in that
case, set
<B>ashift=12</B>

(which is 1&lt;&lt;12 = 4096). When set, this property is
used as the default hint value in subsequent vdev operations (add,
attach and replace). Changing this value will not modify any existing
vdev, not even on disk replacement; however it can be used, for
instance, to replace a dying 512B sectors disk with a newer 4KiB
sectors device: this will probably result in bad performance but at the
same time could prevent loss of data.
<DT><B>autoexpand = on | off</B>














<DD>
Controls automatic pool expansion when the underlying LUN is grown.
If set to
<B>on</B>

 
the pool will be resized according to the size of the expanded device.
If the device is part of a mirror or raidz then all devices within that
mirror/raidz group must be expanded before the new space is made available to
the pool.
The default behavior is
<B>off</B>

 
This property can also be referred to by its shortened column name,
<B>expand</B>

 
<DT><B>autoreplace = on | off</B>














<DD>
Controls automatic device replacement.
If set to
<B>off</B>

 
device replacement must be initiated by the administrator by using the
<B>zpool replace</B>



command.
If set to
<B>on</B>

 
any new device, found in the same physical location as a device that previously
belonged to the pool, is automatically formatted and replaced.
The default behavior is
<B>off</B>

 
This property can also be referred to by its shortened column name,
<B>replace</B>

 
Autoreplace can also be used with virtual disks (like device
mapper) provided that you use the /dev/disk/by-vdev paths setup by
vdev_id.conf. See the
vdev_id8


man page for more details.
Autoreplace and autoonline require the ZFS Event Daemon be configured and
running.  See the
<A HREF="../man8/zed.8.html">zed</A>(8)


man page for more details.
<DT><B>bootfs = (unset) | </B><I>pool </I><B>/ </B><I>dataset</I>




















<DD>
Identifies the default bootable dataset for the root pool. This property is
expected to be set mainly by the installation and upgrade programs.
Not all Linux distribution boot processes use the bootfs property.
<DT><B>cachefile = </B><I>path </I><B>| none</B>














<DD>
Controls the location of where the pool configuration is cached.
Discovering all pools on system startup requires a cached copy of the
configuration data that is stored on the root file system.
All pools in this cache are automatically imported when the system boots.
Some environments, such as install and clustering, need to cache this
information in a different location so that pools are not automatically
imported.
Setting this property caches the pool configuration in a different location that
can later be imported with
<B>zpool import -c</B>





 
Setting it to the value
<B>none</B>

creates a temporary pool that is never cached, and the
Qq (empty string)



uses the default location.
<P>

Multiple pools can share the same cache file.
Because the kernel destroys and recreates this file when pools are added and
removed, care should be taken when attempting to access this file.
When the last pool using a
<B>cachefile</B>

is exported or destroyed, the file will be empty.
<DT><B>comment = </B><I>text</I>








<DD>
A text string consisting of printable ASCII characters that will be stored
such that it is available even if the pool becomes faulted.
An administrator can provide additional information about a pool using this
property.
<DT><B>dedupditto = </B><I>number</I>








<DD>
This property is deprecated.  In a future release, it will no longer have any
effect.
<P>

Threshold for the number of block ditto copies.
If the reference count for a deduplicated block increases above this number, a
new ditto copy of this block is automatically stored.
The default setting is
<B>0</B>

which causes no ditto copies to be created for deduplicated blocks.
The minimum legal nonzero setting is
<B>100</B>

 
<DT><B>delegation = on | off</B>














<DD>
Controls whether a non-privileged user is granted access based on the dataset
permissions defined on the dataset.
See
<A HREF="../man8/zfs.8.html">zfs</A>(8)


for more information on ZFS delegated administration.
<DT><B>failmode = wait | continue | panic</B>




















<DD>
Controls the system behavior in the event of catastrophic pool failure.
This condition is typically a result of a loss of connectivity to the underlying
storage device(s) or a failure of all devices within the pool.
The behavior of such an event is determined as follows:
<DL COMPACT>
<P>

<DT><B>wait</B>


<DD>
Blocks all I/O access until the device connectivity is recovered and the errors
are cleared.
This is the default behavior.
<DT><B>continue</B>


<DD>
Returns
Er EIO

to any new write I/O requests but allows reads to any of the remaining healthy
devices.
Any write requests that have yet to be committed to disk would be blocked.
<DT><B>panic</B>


<DD>
Prints out a message to the console and generates a system crash dump.
</DL>
<P>

<DT><B>autotrim = on | off</B>














<DD>
When set to
<B>on</B>

space which has been recently freed, and is no longer allocated by the pool,
will be periodically trimmed.  This allows block device vdevs which support
BLKDISCARD, such as SSDs, or file vdevs on which the underlying file system
supports hole-punching, to reclaim unused blocks.  The default setting for
this property is
<B>off</B>

 
<P>

Automatic TRIM does not immediately reclaim blocks after a free. Instead,
it will optimistically delay allowing smaller ranges to be aggregated in to
a few larger ones.  These can then be issued more efficiently to the storage.
<P>

Be aware that automatic trimming of recently freed data blocks can put
significant stress on the underlying storage devices.  This will vary
depending of how well the specific device handles these commands.  For
lower end devices it is often possible to achieve most of the benefits
of automatic trimming by running an on-demand (manual) TRIM periodically
using the
<B>zpool trim</B>



command.
<DT><B>feature@ </B><I>feature_name </I><B>= enabled</B>












<DD>
The value of this property is the current state of
<I>feature_name</I>

 
The only valid value when setting this property is
<B>enabled</B>

which moves
<I>feature_name</I>

to the enabled state.
See
zpool-features5


for details on feature states.
<DT><B>listsnapshots = on | off</B>














<DD>
Controls whether information about snapshots associated with this pool is
output when
<B>zfs list</B>



is run without the
-<B>t</B>

option.
The default value is
<B>off</B>

 
This property can also be referred to by its shortened name,
<B>listsnaps</B>

 
<DT><B>multihost = on | off</B>














<DD>
Controls whether a pool activity check should be performed during
<B>zpool import</B>



 
When a pool is determined to be active it cannot be imported, even with the
-<B>f</B>

option.  This property is intended to be used in failover configurations
where multiple hosts have access to a pool on shared storage.
<P>

Multihost provides protection on import only.  It does not protect against an
individual device being used in multiple pools, regardless of the type of vdev.
See the discussion under
<B>zpool create.</B>

<P>

When this property is on, periodic writes to storage occur to show the pool is
in use.  See
<B>zfs_multihost_interval</B>

in the
zfs-module-parameters5


man page.  In order to enable this property each host must set a unique hostid.
See
<A HREF="../man1/genhostid.1.html">genhostid</A>(1)


<A HREF="../man8/zgenhostid.8.html">zgenhostid</A>(8)


spl-module-parameters5


for additional details.  The default value is
<B>off</B>

 
<DT><B>version = </B><I>version</I>








<DD>
The current on-disk version of the pool.
This can be increased, but never decreased.
The preferred method of updating pools is with the
<B>zpool upgrade</B>



command, though this property can be used when a specific version is needed for
backwards compatibility.
Once feature flags are enabled on a pool this property will no longer have a
value.
</DL>
<P>

<A NAME="lbAM">&nbsp;</A>
<H3>Subcommands</H3>

All subcommands that modify state are logged persistently to the pool in their
original form.
<P>

The
<B></B>


command provides subcommands to create and destroy storage pools, add capacity
to storage pools, and provide information about the storage pools.
The following subcommands are supported:
<DL COMPACT>
<P>

<DT><B>
</B>

<B></B>


-<B>?</B>

<DD>

<DD>Displays a help message.
<DT><B>
</B>

<B></B>


-<B>V, -version</B>

<DD>

<DD>An alias for the
<B>zpool version</B>



subcommand.
<DT><B>
</B>

<B></B>


<B>add</B>

[-<B>fgLnP</B>

]

[-<B>o </B><I>property </I><B>= </B><I>value </I>]











<I>pool vdev </I><B>...</B>



<DD>

<DD>Adds the specified virtual devices to the given pool.
The
<I>vdev</I>

specification is described in the
Sx Virtual Devices

section.
The behavior of the
-<B>f</B>

option, and the device checks performed are described in the
<B>zpool create</B>



subcommand.
<DL COMPACT>
<P>

<DT><B>-f</B>


<DD>
Forces use of
<I>vdev </I><B>s</B>



 
even if they appear in use or specify a conflicting replication level.
Not all devices can be overridden in this manner.
<DT><B>-g</B>


<DD>
Display
<I>vdev</I>

 
GUIDs instead of the normal device names. These GUIDs can be used in place of
device names for the zpool detach/offline/remove/replace commands.
<DT><B>-L</B>


<DD>
Display real paths for
<I>vdev </I><B>s</B>



resolving all symbolic links. This can be used to look up the current block
device name regardless of the /dev/disk/ path used to open it.
<DT><B>-n</B>


<DD>
Displays the configuration that would be used without actually adding the
<I>vdev </I><B>s</B>



 
The actual pool creation can still fail due to insufficient privileges or
device sharing.
<DT><B>-P</B>


<DD>
Display real paths for
<I>vdev </I><B>s</B>



instead of only the last component of the path. This can be used in
conjunction with the
-<B>L</B>

flag.
<DT><B>-o </B><I>property </I><B>= </B><I>value</I>










<DD>
Sets the given pool properties. See the
Sx Properties

section for a list of valid properties that can be set. The only property
supported at the moment is ashift.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>attach</B>

[-<B>f</B>

]

[-<B>o </B><I>property </I><B>= </B><I>value </I>]











<I>pool device new_device</I>

<DD>

<DD>Attaches
<I>new_device</I>

to the existing
<I>device</I>

 
The existing device cannot be part of a raidz configuration.
If
<I>device</I>

is not currently part of a mirrored configuration,
<I>device</I>

automatically transforms into a two-way mirror of
<I>device</I>

and
<I>new_device</I>

 
If
<I>device</I>

is part of a two-way mirror, attaching
<I>new_device</I>

creates a three-way mirror, and so on.
In either case,
<I>new_device</I>

begins to resilver immediately.
<DL COMPACT>
<P>

<DT><B>-f</B>


<DD>
Forces use of
<I>new_device</I>

 
even if it appears to be in use.
Not all devices can be overridden in this manner.
<DT><B>-o </B><I>property </I><B>= </B><I>value</I>










<DD>
Sets the given pool properties. See the
Sx Properties

section for a list of valid properties that can be set. The only property
supported at the moment is ashift.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>checkpoint</B>

[-<B>d, -discard</B>

]

<I>pool</I>

<DD>

<DD>Checkpoints the current state of
<I>pool</I>

, which can be later restored by
<B>zpool import --rewind-to-checkpoint</B>



 
The existence of a checkpoint in a pool prohibits the following
<B>zpool</B>

commands:
<B>remove</B>

 
<B>attach</B>

 
<B>detach</B>

 
<B>split</B>

 
and
<B>reguid</B>

 
In addition, it may break reservation boundaries if the pool lacks free
space.
The
<B>zpool status</B>



command indicates the existence of a checkpoint or the progress of discarding a
checkpoint from a pool.
The
<B>zpool list</B>



command reports how much space the checkpoint takes from the pool.
<DL COMPACT>
<P>

<DT><B>-d, -discard</B>


<DD>
Discards an existing checkpoint from
<I>pool</I>

 
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>clear</B>

<I>pool</I>

[<I>device</I>

]

<DD>

<DD>Clears device errors in a pool.
If no arguments are specified, all device errors within the pool are cleared.
If one or more devices is specified, only those errors associated with the
specified device or devices are cleared.
If multihost is enabled, and the pool has been suspended, this will not
resume I/O.  While the pool was suspended, it may have been imported on
another host, and resuming I/O could result in pool damage.
<DT><B>
</B>

<B></B>


<B>create</B>

[-<B>dfn</B>

]

[-<B>m </B><I>mountpoint</I>



]

[-<B>o </B><I>property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>o </B><I>feature@feature </I><B>= </B><I>value </I><B>...</B>

]











[-<B>O </B><I>file-system-property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>R </B><I>root</I>



]

[-<B>t </B><I>tname</I>



]

<I>pool vdev </I><B>...</B>



<DD>

<DD>Creates a new storage pool containing the virtual devices specified on the
command line.
The pool name must begin with a letter, and can only contain
alphanumeric characters as well as underscore
(Qq <B>_</B>



)

 
dash
(Qq <B>-</B>



)

 
colon
(Qq <B>:</B>



)

 
space
(Qq <B>&nbsp;</B>



)

 
and period
(Qq <B>.</B>



)

 
The pool names
<B>mirror</B>

 
<B>raidz</B>

 
<B>spare</B>

and
<B>log</B>

are reserved, as are names beginning with
<B>mirror</B>

 
<B>raidz</B>

 
<B>spare</B>

 
and the pattern
<B>c[0-9]</B>

 
The
<I>vdev</I>

specification is described in the
Sx Virtual Devices

section.
<P>

The command attempts to verify that each device specified is accessible and not
currently in use by another subsystem.  However this check is not robust enough
to detect simultaneous attempts to use a new device in different pools, even if
<B>multihost</B>

is
<B>enabled.</B>

The
administrator must ensure that simultaneous invocations of any combination of
<B>zpool replace</B>

 
<B>zpool create</B>

 
<B>zpool add</B>

 
or
<B>zpool labelclear</B>

 
do not refer to the same device.  Using the same device in two pools will
result in pool corruption.
<P>

There are some uses, such as being currently mounted, or specified as the
dedicated dump device, that prevents a device from ever being used by ZFS.
Other uses, such as having a preexisting UFS file system, can be overridden with
the
-<B>f</B>

option.
<P>

The command also checks that the replication strategy for the pool is
consistent.
An attempt to combine redundant and non-redundant storage in a single pool, or
to mix disks and files, results in an error unless
-<B>f</B>

is specified.
The use of differently sized devices within a single raidz or mirror group is
also flagged as an error unless
-<B>f</B>

is specified.
<P>

Unless the
-<B>R</B>

option is specified, the default mount point is
/ <B></B><I>pool</I>





 
The mount point must not exist or must be empty, or else the root dataset
cannot be mounted.
This can be overridden with the
-<B>m</B>

option.
<P>

By default all supported features are enabled on the new pool unless the
-<B>d</B>

option is specified.
<DL COMPACT>
<P>

<DT><B>-d</B>


<DD>
Do not enable any features on the new pool.
Individual features can be enabled by setting their corresponding properties to
<B>enabled</B>

with the
-<B>o</B>

option.
See
zpool-features5


for details about feature properties.
<DT><B>-f</B>


<DD>
Forces use of
<I>vdev </I><B>s</B>



 
even if they appear in use or specify a conflicting replication level.
Not all devices can be overridden in this manner.
<DT><B>-m </B><I>mountpoint</I>




<DD>
Sets the mount point for the root dataset.
The default mount point is
/pool

or
altroot/pool

if
<I>altroot</I>

is specified.
The mount point must be an absolute path,
<B>legacy</B>

 
or
<B>none</B>

 
For more information on dataset mount points, see
<A HREF="../man8/zfs.8.html">zfs</A>(8).


<DT><B>-n</B>


<DD>
Displays the configuration that would be used without actually creating the
pool.
The actual pool creation can still fail due to insufficient privileges or
device sharing.
<DT><B>-o </B><I>property </I><B>= </B><I>value</I>










<DD>
Sets the given pool properties.
See the
Sx Properties

section for a list of valid properties that can be set.
<DT><B>-o </B><I>feature@feature </I><B>= </B><I>value</I>










<DD>
Sets the given pool feature. See the
zpool-features5


section for a list of valid features that can be set.
Value can be either disabled or enabled.
<DT><B>-O </B><I>file-system-property </I><B>= </B><I>value</I>










<DD>
Sets the given file system properties in the root file system of the pool.
See the
Sx Properties

section of
<A HREF="../man8/zfs.8.html">zfs</A>(8)


for a list of valid properties that can be set.
<DT><B>-R </B><I>root</I>




<DD>
Equivalent to
-<B>o cachefile = none -o altroot = </B><I>root</I>



















<DT><B>-t </B><I>tname</I>




<DD>
Sets the in-core pool name to
<B>tname</B>

while the on-disk name will be the name specified as the pool name
<B>pool</B>

 
This will set the default cachefile property to none. This is intended
to handle name space collisions when creating pools for other systems,
such as virtual machines or physical machines whose pools live on network
block devices.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>destroy</B>

[-<B>f</B>

]

<I>pool</I>

<DD>

<DD>Destroys the given pool, freeing up any devices for other use.
This command tries to unmount any active datasets before destroying the pool.
<DL COMPACT>
<P>

<DT><B>-f</B>


<DD>
Forces any active datasets contained within the pool to be unmounted.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>detach</B>

<I>pool device</I>

<DD>

<DD>Detaches
<I>device</I>

from a mirror.
The operation is refused if there are no other valid replicas of the data.
If device may be re-added to the pool later on then consider the
<B>zpool offline</B>

command instead.
<DT><B>
</B>

<B></B>


<B>events</B>

[-<B>vHf </B>[<I>pool | -</I><B>c</B>

]







]

<DD>

<DD>Lists all recent events generated by the ZFS kernel modules.  These events
are consumed by the
<A HREF="../man8/zed.8.html">zed</A>(8)


and used to automate administrative tasks such as replacing a failed device
with a hot spare. For more information about the subclasses and event payloads
that can be generated see the
zfs-events5


man page.
<DL COMPACT>
<P>

<DT><B>-c</B>


<DD>
Clear all previous events.
<DT><B>-f</B>


<DD>
Follow mode.
<DT><B>-H</B>


<DD>
Scripted mode. Do not display headers, and separate fields by a
single tab instead of arbitrary space.
<DT><B>-v</B>


<DD>
Print the entire payload for each event.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>export</B>

[-<B>a</B>

]

[-<B>f</B>

]

<I>pool </I><B>...</B>



<DD>

<DD>Exports the given pools from the system.
All devices are marked as exported, but are still considered in use by other
subsystems.
The devices can be moved between systems
(even those of different endianness)

and imported as long as a sufficient number of devices are present.
<P>

Before exporting the pool, all datasets within the pool are unmounted.
A pool can not be exported if it has a shared spare that is currently being
used.
<P>

For pools to be portable, you must give the
<B></B>


command whole disks, not just partitions, so that ZFS can label the disks with
portable EFI labels.
Otherwise, disk drivers on platforms of different endianness will not recognize
the disks.
<DL COMPACT>
<P>

<DT><B>-a</B>


<DD>
Exports all pools imported on the system.
<DT><B>-f</B>


<DD>
Forcefully unmount all datasets, using the
<B>unmount -f</B>



command.
<P>

This command will forcefully export the pool even if it has a shared spare that
is currently being used.
This may lead to potential data corruption.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>get</B>

[-<B>Hp </B>[-<B>o </B><I>field </I><B></B>[, <B></B><I>field </I><B>...</B>

]











]





]

<B>all | </B><I>property </I><B></B>[, <B></B><I>property </I><B>...</B>

]















[<I>pool </I><B>...</B>

]



<DD>

<DD>Retrieves the given list of properties
Po or all properties if

<B>all</B>

is used
Pc for the specified storage pool(s).

These properties are displayed with the following fields:

<PRE>
        name          Name of storage pool
        property      Property name
        value         Property value
        source        Property source, either 'default' or 'local'.
</PRE>

<P>

See the
Sx Properties

section for more information on the available pool properties.
<DL COMPACT>
<P>

<DT><B>-H</B>


<DD>
Scripted mode.
Do not display headers, and separate fields by a single tab instead of arbitrary
space.
<DT><B>-o </B><I>field</I>




<DD>
A comma-separated list of columns to display.
<B>name , property , value , source</B>



















is the default value.
<DT><B>-p</B>


<DD>
Display numbers in parsable (exact) values.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>history</B>

[-<B>il</B>

]

[<I>pool </I><B>...</B>

]



<DD>

<DD>Displays the command history of the specified pool(s) or all pools if no pool is
specified.
<DL COMPACT>
<P>

<DT><B>-i</B>


<DD>
Displays internally logged ZFS events in addition to user initiated events.
<DT><B>-l</B>


<DD>
Displays log records in long format, which in addition to standard format
includes, the user name, the hostname, and the zone in which the operation was
performed.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>import</B>

[-<B>D</B>

]

[-<B>d </B><I>dir </I><B>| device</B>







]

<DD>

<DD>Lists pools available to import.
If the
-<B>d</B>

option is not specified, this command searches for devices in
/dev

 
The
-<B>d</B>

option can be specified multiple times, and all directories are searched.
If the device appears to be part of an exported pool, this command displays a
summary of the pool with the name of the pool, a numeric identifier, as well as
the vdev layout and current health of the device for each device or file.
Destroyed pools, pools that were previously destroyed with the
<B>zpool destroy</B>



command, are not listed unless the
-<B>D</B>

option is specified.
<P>

The numeric identifier is unique, and can be used instead of the pool name when
multiple exported pools of the same name are available.
<DL COMPACT>
<P>

<DT><B>-c </B><I>cachefile</I>




<DD>
Reads configuration from the given
<I>cachefile</I>

that was created with the
<B>cachefile</B>

pool property.
This
<I>cachefile</I>

is used instead of searching for devices.
<DT><B>-d </B><I>dir </I><B>| </B><I>device</I>










<DD>
Uses
<I>device</I>

or searches for devices or files in
<I>dir</I>

 
The
-<B>d</B>

option can be specified multiple times.
<DT><B>-D</B>


<DD>
Lists destroyed pools only.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>import</B>

-<B>a</B>

[-<B>DflmN</B>

]

[-<B>F </B>[-<B>n </B>[-<B>T </B>[-<B>X </B>]



]



]





]

[-<B>c </B><I>cachefile </I><B>| -d </B><I>dir </I><B>| device</B>















]

[-<B>o </B><I>mntopts</I>



]

[-<B>o </B><I>property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>R </B><I>root</I>



]

[-<B>s</B>

]

<DD>

<DD>Imports all pools found in the search directories.
Identical to the previous command, except that all pools with a sufficient
number of devices available are imported.
Destroyed pools, pools that were previously destroyed with the
<B>zpool destroy</B>



command, will not be imported unless the
-<B>D</B>

option is specified.
<DL COMPACT>
<P>

<DT><B>-a</B>


<DD>
Searches for and imports all pools found.
<DT><B>-c </B><I>cachefile</I>




<DD>
Reads configuration from the given
<I>cachefile</I>

that was created with the
<B>cachefile</B>

pool property.
This
<I>cachefile</I>

is used instead of searching for devices.
<DT><B>-d </B><I>dir </I><B>| </B><I>device</I>










<DD>
Uses
<I>device</I>

or searches for devices or files in
<I>dir</I>

 
The
-<B>d</B>

option can be specified multiple times.
This option is incompatible with the
-<B>c</B>

option.
<DT><B>-D</B>


<DD>
Imports destroyed pools only.
The
-<B>f</B>

option is also required.
<DT><B>-f</B>


<DD>
Forces import, even if the pool appears to be potentially active.
<DT><B>-F</B>


<DD>
Recovery mode for a non-importable pool.
Attempt to return the pool to an importable state by discarding the last few
transactions.
Not all damaged pools can be recovered by using this option.
If successful, the data from the discarded transactions is irretrievably lost.
This option is ignored if the pool is importable or already imported.
<DT><B>-l</B>


<DD>
Indicates that this command will request encryption keys for all encrypted
datasets it attempts to mount as it is bringing the pool online. Note that if
any datasets have a
<B>keylocation</B>

of
<B>prompt</B>

this command will block waiting for the keys to be entered. Without this flag
encrypted datasets will be left unavailable until the keys are loaded.
<DT><B>-m</B>


<DD>
Allows a pool to import when there is a missing log device.
Recent transactions can be lost because the log device will be discarded.
<DT><B>-n</B>


<DD>
Used with the
-<B>F</B>

recovery option.
Determines whether a non-importable pool can be made importable again, but does
not actually perform the pool recovery.
For more details about pool recovery mode, see the
-<B>F</B>

option, above.
<DT><B>-N</B>


<DD>
Import the pool without mounting any file systems.
<DT><B>-o </B><I>mntopts</I>




<DD>
Comma-separated list of mount options to use when mounting datasets within the
pool.
See
<A HREF="../man8/zfs.8.html">zfs</A>(8)


for a description of dataset properties and mount options.
<DT><B>-o </B><I>property </I><B>= </B><I>value</I>










<DD>
Sets the specified property on the imported pool.
See the
Sx Properties

section for more information on the available pool properties.
<DT><B>-R </B><I>root</I>




<DD>
Sets the
<B>cachefile</B>

property to
<B>none</B>

and the
<B>altroot</B>

property to
<I>root</I>

 
<DT><B>--rewind-to-checkpoint</B>


<DD>
Rewinds pool to the checkpointed state.
Once the pool is imported with this flag there is no way to undo the rewind.
All changes and data that were written after the checkpoint are lost!
The only exception is when the
<B>readonly</B>

mounting option is enabled.
In this case, the checkpointed state of the pool is opened and an
administrator can see how the pool would look like if they were
to fully rewind.
<DT><B>-s</B>


<DD>
Scan using the default search path, the libblkid cache will not be
consulted. A custom search path may be specified by setting the
ZPOOL_IMPORT_PATH environment variable.
<DT><B>-X</B>


<DD>
Used with the
-<B>F</B>

recovery option. Determines whether extreme
measures to find a valid txg should take place. This allows the pool to
be rolled back to a txg which is no longer guaranteed to be consistent.
Pools imported at an inconsistent txg may contain uncorrectable
checksum errors. For more details about pool recovery mode, see the
-<B>F</B>

option, above. WARNING: This option can be extremely hazardous to the
health of your pool and should only be used as a last resort.
<DT><B>-T</B>


<DD>
Specify the txg to use for rollback. Implies
-<B>FX</B>

 
For more details
about pool recovery mode, see the
-<B>X</B>

option, above. WARNING: This option can be extremely hazardous to the
health of your pool and should only be used as a last resort.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>import</B>

[-<B>Dflm</B>

]

[-<B>F </B>[-<B>n </B>[-<B>t </B>[-<B>T </B>[-<B>X </B>]



]



]



]





]

[-<B>c </B><I>cachefile </I><B>| -d </B><I>dir </I><B>| device</B>















]

[-<B>o </B><I>mntopts</I>



]

[-<B>o </B><I>property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>R </B><I>root</I>



]

[-<B>s</B>

]

<I>pool </I><B>| </B><I>id</I>







[<I>newpool</I>

]

<DD>

<DD>Imports a specific pool.
A pool can be identified by its name or the numeric identifier.
If
<I>newpool</I>

is specified, the pool is imported using the name
<I>newpool</I>

 
Otherwise, it is imported with the same name as its exported name.
<P>

If a device is removed from a system without running
<B>zpool export</B>



first, the device appears as potentially active.
It cannot be determined if this was a failed export, or whether the device is
really in use from another host.
To import a pool in this state, the
-<B>f</B>

option is required.
<DL COMPACT>
<P>

<DT><B>-c </B><I>cachefile</I>




<DD>
Reads configuration from the given
<I>cachefile</I>

that was created with the
<B>cachefile</B>

pool property.
This
<I>cachefile</I>

is used instead of searching for devices.
<DT><B>-d </B><I>dir </I><B>| </B><I>device</I>










<DD>
Uses
<I>device</I>

or searches for devices or files in
<I>dir</I>

 
The
-<B>d</B>

option can be specified multiple times.
This option is incompatible with the
-<B>c</B>

option.
<DT><B>-D</B>


<DD>
Imports destroyed pool.
The
-<B>f</B>

option is also required.
<DT><B>-f</B>


<DD>
Forces import, even if the pool appears to be potentially active.
<DT><B>-F</B>


<DD>
Recovery mode for a non-importable pool.
Attempt to return the pool to an importable state by discarding the last few
transactions.
Not all damaged pools can be recovered by using this option.
If successful, the data from the discarded transactions is irretrievably lost.
This option is ignored if the pool is importable or already imported.
<DT><B>-l</B>


<DD>
Indicates that this command will request encryption keys for all encrypted
datasets it attempts to mount as it is bringing the pool online. Note that if
any datasets have a
<B>keylocation</B>

of
<B>prompt</B>

this command will block waiting for the keys to be entered. Without this flag
encrypted datasets will be left unavailable until the keys are loaded.
<DT><B>-m</B>


<DD>
Allows a pool to import when there is a missing log device.
Recent transactions can be lost because the log device will be discarded.
<DT><B>-n</B>


<DD>
Used with the
-<B>F</B>

recovery option.
Determines whether a non-importable pool can be made importable again, but does
not actually perform the pool recovery.
For more details about pool recovery mode, see the
-<B>F</B>

option, above.
<DT><B>-o </B><I>mntopts</I>




<DD>
Comma-separated list of mount options to use when mounting datasets within the
pool.
See
<A HREF="../man8/zfs.8.html">zfs</A>(8)


for a description of dataset properties and mount options.
<DT><B>-o </B><I>property </I><B>= </B><I>value</I>










<DD>
Sets the specified property on the imported pool.
See the
Sx Properties

section for more information on the available pool properties.
<DT><B>-R </B><I>root</I>




<DD>
Sets the
<B>cachefile</B>

property to
<B>none</B>

and the
<B>altroot</B>

property to
<I>root</I>

 
<DT><B>-s</B>


<DD>
Scan using the default search path, the libblkid cache will not be
consulted. A custom search path may be specified by setting the
ZPOOL_IMPORT_PATH environment variable.
<DT><B>-X</B>


<DD>
Used with the
-<B>F</B>

recovery option. Determines whether extreme
measures to find a valid txg should take place. This allows the pool to
be rolled back to a txg which is no longer guaranteed to be consistent.
Pools imported at an inconsistent txg may contain uncorrectable
checksum errors. For more details about pool recovery mode, see the
-<B>F</B>

option, above. WARNING: This option can be extremely hazardous to the
health of your pool and should only be used as a last resort.
<DT><B>-T</B>


<DD>
Specify the txg to use for rollback. Implies
-<B>FX</B>

 
For more details
about pool recovery mode, see the
-<B>X</B>

option, above. WARNING: This option can be extremely hazardous to the
health of your pool and should only be used as a last resort.
<DT><B>-t</B>


<DD>
Used with
<B>newpool</B>

 
Specifies that
<B>newpool</B>

is temporary. Temporary pool names last until export. Ensures that
the original pool name will be used in all label updates and therefore
is retained upon export.
Will also set -o cachefile=none when not explicitly specified.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>initialize</B>

[-<B>c | -s</B>



]

<I>pool</I>

[<I>device </I><B>...</B>



]

<DD>

<DD>Begins initializing by writing to all unallocated regions on the specified
devices, or all eligible devices in the pool if no individual devices are
specified.
Only leaf data or log devices may be initialized.
<DL COMPACT>
<P>

<DT><B>-c, -cancel</B>


<DD>
Cancel initializing on the specified devices, or all eligible devices if none
are specified.
If one or more target devices are invalid or are not currently being
initialized, the command will fail and no cancellation will occur on any device.
<DT><B>-s -suspend</B>


<DD>
Suspend initializing on the specified devices, or all eligible devices if none
are specified.
If one or more target devices are invalid or are not currently being
initialized, the command will fail and no suspension will occur on any device.
Initializing can then be resumed by running
<B>zpool initialize</B>



with no flags on the relevant target devices.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>iostat</B>

[[[-<B>c </B><I>SCRIPT </I>[-<B>lq | -rw</B>





]
]



]






]

[-<B>T u | d</B>









]

[-<B>ghHLnpPvy</B>

]

[[<I>pool </I><B>... | </B>[<I>pool vdev </I><B>... | </B>[<I>vdev </I><B>... </B>]
]









]









]






[<I>interval </I>[<I>count</I>

]



]

<DD>

<DD>Displays logical I/O statistics for the given pools/vdevs. Physical I/Os may
be observed via
<A HREF="../man1/iostat.1.html">iostat</A>(1).


If writes are located nearby, they may be merged into a single
larger operation. Additional I/O may be generated depending on the level of
vdev redundancy.
To filter output, you may pass in a list of pools, a pool and list of vdevs
in that pool, or a list of any vdevs from any pool. If no items are specified,
statistics for every pool in the system are shown.
When given an
<I>interval</I>

 
the statistics are printed every
<I>interval</I>

seconds until ^C is pressed. If 
-<B>n</B>

flag is specified the headers are displayed only once, otherwise they are 
displayed periodically. If count is specified, the command exits
after count reports are printed. The first report printed is always
the statistics since boot regardless of whether
<I>interval</I>

and
<I>count</I>

are passed. However, this behavior can be suppressed with the
-<B>y</B>

flag. Also note that the units of
<B>K</B>

 
<B>M</B>

 
<B>G ...</B>

that are printed in the report are in base 1024. To get the raw
values, use the
-<B>p</B>

flag.
<DL COMPACT>
<P>

<DT><B>-c </B>[<I>SCRIPT1 </I><B></B>[, <B></B><I>SCRIPT2 </I><B>...</B>

]









]




<DD>
Run a script (or scripts) on each vdev and include the output as a new column
in the
<B>zpool iostat</B>



output. Users can run any script found in their
~/.zpool.d

directory or from the system
/etc/zfs/zpool.d

directory. Script names containing the slash (/) character are not allowed.
The default search path can be overridden by setting the
ZPOOL_SCRIPTS_PATH environment variable. A privileged user can run
-<B>c</B>

if they have the ZPOOL_SCRIPTS_AS_ROOT
environment variable set. If a script requires the use of a privileged
command, like
<A HREF="../man8/smartctl.8.html">smartctl</A>(8),


then it's recommended you allow the user access to it in
/etc/sudoers

or add the user to the
/etc/sudoers.d/zfs

file.
<P>

If
-<B>c</B>

is passed without a script name, it prints a list of all scripts.
-<B>c</B>

also sets verbose mode
<B>( -v ).</B>









<P>

Script output should be in the form of &quot;name=value&quot;. The column name is
set to &quot;name&quot; and the value is set to &quot;value&quot;. Multiple lines can be
used to output multiple columns. The first line of output not in the
&quot;name=value&quot; format is displayed without a column title, and no more
output after that is displayed. This can be useful for printing error
messages. Blank or NULL values are printed as a '-' to make output
awk-able.
<P>

The following environment variables are set before running each script:
<DL COMPACT>
<P>

<DT><B>VDEV_PATH</B>


<DD>
Full path to the vdev
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>VDEV_UPATH</B>


<DD>
Underlying path to the vdev (/dev/sd*).  For use with device mapper,
multipath, or partitioned vdevs.
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>VDEV_ENC_SYSFS_PATH</B>


<DD>
The sysfs path to the enclosure for the vdev (if any).
</DL>
<P>

<DT><B>-T u | d</B>










<DD>
Display a time stamp.
Specify
<B>u</B>

for a printed representation of the internal representation of time.
See
<A HREF="../man2/time.2.html">time</A>(2).


Specify
<B>d</B>

for standard date format.
See
<A HREF="../man1/date.1.html">date</A>(1).


<DT><B>-g</B>


<DD>
Display vdev GUIDs instead of the normal device names. These GUIDs
can be used in place of device names for the zpool
detach/offline/remove/replace commands.
<DT><B>-H</B>


<DD>
Scripted mode. Do not display headers, and separate fields by a
single tab instead of arbitrary space.
<DT><B>-L</B>


<DD>
Display real paths for vdevs resolving all symbolic links. This can
be used to look up the current block device name regardless of the
/dev/disk/

path used to open it.
<DT><B>-n</B>


<DD>
Print headers only once when passed
<DT><B>-p</B>


<DD>
Display numbers in parsable (exact) values. Time values are in
nanoseconds.
<DT><B>-P</B>


<DD>
Display full paths for vdevs instead of only the last component of
the path. This can be used in conjunction with the
-<B>L</B>

flag.
<DT><B>-r</B>


<DD>
Print request size histograms for the leaf vdev's IO. This includes
histograms of individual IOs (ind) and aggregate IOs (agg). These stats
can be useful for observing how well IO aggregation is working.  Note
that TRIM IOs may exceed 16M, but will be counted as 16M.
<DT><B>-v</B>


<DD>
Verbose statistics Reports usage statistics for individual vdevs within the
pool, in addition to the pool-wide statistics.
<DT><B>-y</B>


<DD>
Omit statistics since boot.
Normally the first line of output reports the statistics since boot.
This option suppresses that first line of output.
<I>interval</I>

<DT><B>-w</B>


<DD>
Display latency histograms:
<P>

<I>total_wait</I>

 
Total IO time (queuing + disk IO time).
<I>disk_wait</I>

 
Disk IO time (time reading/writing the disk).
<I>syncq_wait</I>

 
Amount of time IO spent in synchronous priority queues.  Does not include
disk time.
<I>asyncq_wait</I>

 
Amount of time IO spent in asynchronous priority queues.  Does not include
disk time.
<I>scrub</I>

 
Amount of time IO spent in scrub queue. Does not include disk time.
<DT><B>-l</B>


<DD>
Include average latency statistics:
<P>

<I>total_wait</I>

 
Average total IO time (queuing + disk IO time).
<I>disk_wait</I>

 
Average disk IO time (time reading/writing the disk).
<I>syncq_wait</I>

 
Average amount of time IO spent in synchronous priority queues. Does
not include disk time.
<I>asyncq_wait</I>

 
Average amount of time IO spent in asynchronous priority queues.
Does not include disk time.
<I>scrub</I>

 
Average queuing time in scrub queue. Does not include disk time.
<I>trim</I>

 
Average queuing time in trim queue. Does not include disk time.
<DT><B>-q</B>


<DD>
Include active queue statistics. Each priority queue has both
pending (
<I>pend</I>

 
and active (
<I>activ</I>

 
IOs. Pending IOs are waiting to
be issued to the disk, and active IOs have been issued to disk and are
waiting for completion. These stats are broken out by priority queue:
<P>

<I>syncq_read/write</I>

 
Current number of entries in synchronous priority
queues.
<I>asyncq_read/write</I>

 
Current number of entries in asynchronous priority queues.
<I>scrubq_read</I>

 
Current number of entries in scrub queue.
<I>trimq_write</I>

 
Current number of entries in trim queue.
<P>

All queue statistics are instantaneous measurements of the number of
entries in the queues. If you specify an interval, the measurements
will be sampled from the end of the interval.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>labelclear</B>

[-<B>f</B>

]

<I>device</I>

<DD>

<DD>Removes ZFS label information from the specified
<I>device</I>

 
The
<I>device</I>

must not be part of an active pool configuration.
<DL COMPACT>
<P>

<DT><B>-f</B>


<DD>
Treat exported or foreign devices as inactive.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>list</B>

[-<B>HgLpPv </B>[-<B>o </B><I>property </I><B></B>[, <B></B><I>property </I><B>...</B>

]











]





]

[-<B>T u | d</B>









]

[<I>pool </I><B>...</B>

]



[<I>interval </I>[<I>count</I>

]



]

<DD>

<DD>Lists the given pools along with a health status and space usage.
If no
<I>pool </I><B>s</B>



are specified, all pools in the system are listed.
When given an
<I>interval</I>

 
the information is printed every
<I>interval</I>

seconds until ^C is pressed.
If
<I>count</I>

is specified, the command exits after
<I>count</I>

reports are printed.
<DL COMPACT>
<P>

<DT><B>-g</B>


<DD>
Display vdev GUIDs instead of the normal device names. These GUIDs
can be used in place of device names for the zpool
detach/offline/remove/replace commands.
<DT><B>-H</B>


<DD>
Scripted mode.
Do not display headers, and separate fields by a single tab instead of arbitrary
space.
<DT><B>-o </B><I>property</I>




<DD>
Comma-separated list of properties to display.
See the
Sx Properties

section for a list of valid properties.
The default list is
<B>name , size , allocated , free , checkpoint, expandsize , fragmentation</B>

 
<B>capacity , dedupratio , health , altroot</B>

 
<DT><B>-L</B>


<DD>
Display real paths for vdevs resolving all symbolic links. This can
be used to look up the current block device name regardless of the
/dev/disk/ path used to open it.
<DT><B>-p</B>


<DD>
Display numbers in parsable
(exact)

values.
<DT><B>-P</B>


<DD>
Display full paths for vdevs instead of only the last component of
the path. This can be used in conjunction with the
-<B>L</B>

flag.
<DT><B>-T u | d</B>










<DD>
Display a time stamp.
Specify
<B>u</B>

for a printed representation of the internal representation of time.
See
<A HREF="../man2/time.2.html">time</A>(2).


Specify
<B>d</B>

for standard date format.
See
<A HREF="../man1/date.1.html">date</A>(1).


<DT><B>-v</B>


<DD>
Verbose statistics.
Reports usage statistics for individual vdevs within the pool, in addition to
the pool-wise statistics.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>offline</B>

[-<B>f</B>

]

[-<B>t</B>

]

<I>pool device </I><B>...</B>





<DD>

<DD>Takes the specified physical device offline.
While the
<I>device</I>

is offline, no attempt is made to read or write to the device.
This command is not applicable to spares.
<DL COMPACT>
<P>

<DT><B>-f</B>


<DD>
Force fault. Instead of offlining the disk, put it into a faulted
state. The fault will persist across imports unless the
-<B>t</B>

flag was specified.
<DT><B>-t</B>


<DD>
Temporary.
Upon reboot, the specified physical device reverts to its previous state.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>online</B>

[-<B>e</B>

]

<I>pool device </I><B>...</B>





<DD>

<DD>Brings the specified physical device online.
This command is not applicable to spares.
<DL COMPACT>
<P>

<DT><B>-e</B>


<DD>
Expand the device to use all available space.
If the device is part of a mirror or raidz then all devices must be expanded
before the new space will become available to the pool.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>reguid</B>

<I>pool</I>

<DD>

<DD>Generates a new unique identifier for the pool.
You must ensure that all devices in this pool are online and healthy before
performing this action.
<DT><B>
</B>

<B></B>


<B>reopen</B>

[-<B>n</B>

]

<I>pool</I>

<DD>

<DD>Reopen all the vdevs associated with the pool.
<DL COMPACT>
<P>

<DT><B>-n</B>


<DD>
Do not restart an in-progress scrub operation. This is not recommended and can
result in partially resilvered devices unless a second scrub is performed.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>remove</B>

[-<B>np</B>

]

<I>pool device </I><B>...</B>





<DD>

<DD>Removes the specified device from the pool.
This command supports removing hot spare, cache, log, and both mirrored and
non-redundant primary top-level vdevs, including dedup and special vdevs.
When the primary pool storage includes a top-level raidz vdev only hot spare,
cache, and log devices can be removed.
<P>
Removing a top-level vdev reduces the total amount of space in the storage pool.
The specified device will be evacuated by copying all allocated space from it to
the other devices in the pool.
In this case, the
<B>zpool remove</B>



command initiates the removal and returns, while the evacuation continues in
the background.
The removal progress can be monitored with
<B>zpool status</B>



 
If an IO error is encountered during the removal process it will be
cancelled. The
<B>device_removal</B>

feature flag must be enabled to remove a top-level vdev, see
zpool-features5.


<P>

A mirrored top-level device (log or data) can be removed by specifying the top-level mirror for the
same.
Non-log devices or data devices that are part of a mirrored configuration can be removed using
the
<B>zpool detach</B>



command.
<DL COMPACT>
<P>

<DT><B>-n</B>


<DD>
Do not actually perform the removal (&quot;no-op&quot;).
Instead, print the estimated amount of memory that will be used by the
mapping table after the removal completes.
This is nonzero only for top-level vdevs.
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>-p</B>


<DD>
Used in conjunction with the
-<B>n</B>

flag, displays numbers as parsable (exact) values.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>remove</B>

-<B>s</B>

<I>pool</I>

<DD>

<DD>Stops and cancels an in-progress removal of a top-level vdev.
<DT><B>
</B>

<B></B>


<B>replace</B>

[-<B>f</B>

]

[-<B>o </B><I>property </I><B>= </B><I>value</I>









]

<I>pool device </I>[<I>new_device</I>

]





<DD>

<DD>Replaces
<I>old_device</I>

with
<I>new_device</I>

 
This is equivalent to attaching
<I>new_device</I>

 
waiting for it to resilver, and then detaching
<I>old_device</I>

 
<P>

The size of
<I>new_device</I>

must be greater than or equal to the minimum size of all the devices in a mirror
or raidz configuration.
<P>

<I>new_device</I>

is required if the pool is not redundant.
If
<I>new_device</I>

is not specified, it defaults to
<I>old_device</I>

 
This form of replacement is useful after an existing disk has failed and has
been physically replaced.
In this case, the new disk may have the same
/dev

path as the old device, even though it is actually a different disk.
ZFS recognizes this.
<DL COMPACT>
<P>

<DT><B>-f</B>


<DD>
Forces use of
<I>new_device</I>

 
even if it appears to be in use.
Not all devices can be overridden in this manner.
<DT><B>-o </B><I>property </I><B>= </B><I>value</I>










<DD>
Sets the given pool properties. See the
Sx Properties

section for a list of valid properties that can be set.
The only property supported at the moment is
<B>ashift</B>

 
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>scrub</B>

[-<B>s | -p</B>



]

<I>pool </I><B>...</B>



<DD>

<DD>Begins a scrub or resumes a paused scrub.
The scrub examines all data in the specified pools to verify that it checksums
correctly.
For replicated
(mirror or raidz)

devices, ZFS automatically repairs any damage discovered during the scrub.
The
<B>zpool status</B>



command reports the progress of the scrub and summarizes the results of the
scrub upon completion.
<P>

Scrubbing and resilvering are very similar operations.
The difference is that resilvering only examines data that ZFS knows to be out
of date
Po for example, when attaching a new device to a mirror or replacing an existing

device
Pc ,

whereas scrubbing examines all data to discover silent errors due to hardware
faults or disk failure.
<P>

Because scrubbing and resilvering are I/O-intensive operations, ZFS only allows
one at a time.
If a scrub is paused, the
<B>zpool scrub</B>



resumes it.
If a resilver is in progress, ZFS does not allow a scrub to be started until the
resilver completes.
<P>

Note that, due to changes in pool data on a live system, it is possible for
scrubs to progress slightly beyond 100% completion. During this period, no
completion time estimate will be provided.
<DL COMPACT>
<P>

<DT><B>-s</B>


<DD>
Stop scrubbing.
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>-p</B>


<DD>
Pause scrubbing.
Scrub pause state and progress are periodically synced to disk.
If the system is restarted or pool is exported during a paused scrub,
even after import, scrub will remain paused until it is resumed.
Once resumed the scrub will pick up from the place where it was last
checkpointed to disk.
To resume a paused scrub issue
<B>zpool scrub</B>



again.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>resilver</B>

<I>pool </I><B>...</B>



<DD>

<DD>Starts a resilver. If an existing resilver is already running it will be
restarted from the beginning. Any drives that were scheduled for a deferred
resilver will be added to the new one. This requires the
<B>resilver_defer</B>

feature.
<DT><B>
</B>

<B></B>


<B>trim</B>

[-<B>d</B>

]

[-<B>c | -s</B>



]

<I>pool</I>

[<I>device </I><B>...</B>



]

<DD>

<DD>Initiates an immediate on-demand TRIM operation for all of the free space in
a pool.  This operation informs the underlying storage devices of all blocks
in the pool which are no longer allocated and allows thinly provisioned
devices to reclaim the space.
<P>

A manual on-demand TRIM operation can be initiated irrespective of the
<B>autotrim</B>

pool property setting.  See the documentation for the
<B>autotrim</B>

property above for the types of vdev devices which can be trimmed.
<DL COMPACT>
<P>

<DT><B>-d -secure</B>


<DD>
Causes a secure TRIM to be initiated.  When performing a secure TRIM, the
device guarantees that data stored on the trimmed blocks has been erased.
This requires support from the device and is not supported by all SSDs.
<DT><B>-r -rate </B><I>rate</I>




<DD>
Controls the rate at which the TRIM operation progresses.  Without this
option TRIM is executed as quickly as possible. The rate, expressed in bytes
per second, is applied on a per-vdev basis and may be set differently for
each leaf vdev.
<DT><B>-c, -cancel</B>


<DD>
Cancel trimming on the specified devices, or all eligible devices if none
are specified.
If one or more target devices are invalid or are not currently being
trimmed, the command will fail and no cancellation will occur on any device.
<DT><B>-s -suspend</B>


<DD>
Suspend trimming on the specified devices, or all eligible devices if none
are specified.
If one or more target devices are invalid or are not currently being
trimmed, the command will fail and no suspension will occur on any device.
Trimming can then be resumed by running
<B>zpool trim</B>



with no flags on the relevant target devices.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>set</B>

<I>property </I><B>= </B><I>value</I>







<I>pool</I>

<DD>

<DD>Sets the given property on the specified pool.
See the
Sx Properties

section for more information on what properties can be set and acceptable
values.
<DT><B>
</B>

<B></B>


<B>split</B>

[-<B>gLlnP</B>

]

[-<B>o </B><I>property </I><B>= </B><I>value </I><B>...</B>

]











[-<B>R </B><I>root</I>



]

<I>pool newpool</I>

[<I>device ...</I>

]

<DD>

<DD>Splits devices off
<I>pool</I>

creating
<I>newpool</I>

 
All vdevs in
<I>pool</I>

must be mirrors and the pool must not be in the process of resilvering.
At the time of the split,
<I>newpool</I>

will be a replica of
<I>pool</I>

 
By default, the
last device in each mirror is split from
<I>pool</I>

to create
<I>newpool</I>

 
<P>

The optional device specification causes the specified device(s) to be
included in the new
<I>pool</I>

and, should any devices remain unspecified,
the last device in each mirror is used as would be by default.
<DL COMPACT>
<P>

<DT><B>-g</B>


<DD>
Display vdev GUIDs instead of the normal device names. These GUIDs
can be used in place of device names for the zpool
detach/offline/remove/replace commands.
<DT><B>-L</B>


<DD>
Display real paths for vdevs resolving all symbolic links. This can
be used to look up the current block device name regardless of the
/dev/disk/

path used to open it.
<DT><B>-l</B>


<DD>
Indicates that this command will request encryption keys for all encrypted
datasets it attempts to mount as it is bringing the new pool online. Note that
if any datasets have a
<B>keylocation</B>

of
<B>prompt</B>

this command will block waiting for the keys to be entered. Without this flag
encrypted datasets will be left unavailable until the keys are loaded.
<DT><B>-n</B>


<DD>
Do dry run, do not actually perform the split.
Print out the expected configuration of
<I>newpool</I>

 
<DT><B>-P</B>


<DD>
Display full paths for vdevs instead of only the last component of
the path. This can be used in conjunction with the
-<B>L</B>

flag.
<DT><B>-o </B><I>property </I><B>= </B><I>value</I>










<DD>
Sets the specified property for
<I>newpool</I>

 
See the
Sx Properties

section for more information on the available pool properties.
<DT><B>-R </B><I>root</I>




<DD>
Set
<B>altroot</B>

for
<I>newpool</I>

to
<I>root</I>

and automatically import it.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>status</B>

[-<B>c </B>[<I>SCRIPT1 </I><B></B>[, <B></B><I>SCRIPT2 </I><B>...</B>

]









]



]

[-<B>DigLpPstvx</B>

]

[-<B>T u | d</B>









]

[<I>pool </I><B>...</B>

]



[<I>interval </I>[<I>count</I>

]



]

<DD>

<DD>Displays the detailed health status for the given pools.
If no
<I>pool</I>

is specified, then the status of each pool in the system is displayed.
For more information on pool and device health, see the
Sx Device Failure and Recovery

section.
<P>

If a scrub or resilver is in progress, this command reports the percentage done
and the estimated time to completion.
Both of these are only approximate, because the amount of data in the pool and
the other workloads on the system can change.
<DL COMPACT>
<P>

<DT><B>-c </B>[<I>SCRIPT1 </I><B></B>[, <B></B><I>SCRIPT2 </I><B>...</B>

]









]




<DD>
Run a script (or scripts) on each vdev and include the output as a new column
in the
<B>zpool status</B>



output.  See the
-<B>c</B>

option of
<B>zpool iostat</B>



for complete details.
<DT><B>-i</B>


<DD>
Display vdev initialization status.
<DT><B>-g</B>


<DD>
Display vdev GUIDs instead of the normal device names. These GUIDs
can be used in place of device names for the zpool
detach/offline/remove/replace commands.
<DT><B>-L</B>


<DD>
Display real paths for vdevs resolving all symbolic links. This can
be used to look up the current block device name regardless of the
/dev/disk/

path used to open it.
<DT><B>-p</B>


<DD>
Display numbers in parsable (exact) values.
<DT><B>-P</B>


<DD>
Display full paths for vdevs instead of only the last component of
the path. This can be used in conjunction with the
-<B>L</B>

flag.
<DT><B>-D</B>


<DD>
Display a histogram of deduplication statistics, showing the allocated
(physically present on disk)

and referenced
(logically referenced in the pool)

block counts and sizes by reference count.
<DT><B>-s</B>


<DD>
Display the number of leaf VDEV slow IOs.  This is the number of IOs that
didn't complete in <B>zio_slow_io_ms</B> milliseconds (default 30 seconds).
This does not necessarily mean the IOs failed to complete, just took an
unreasonably long amount of time.  This may indicate a problem with the
underlying storage.
<DT><B>-t</B>


<DD>
Display vdev TRIM status.
<DT><B>-T u | d</B>










<DD>
Display a time stamp.
Specify
<B>u</B>

for a printed representation of the internal representation of time.
See
<A HREF="../man2/time.2.html">time</A>(2).


Specify
<B>d</B>

for standard date format.
See
<A HREF="../man1/date.1.html">date</A>(1).


<DT><B>-v</B>


<DD>
Displays verbose data error information, printing out a complete list of all
data errors since the last complete pool scrub.
<DT><B>-x</B>


<DD>
Only display status for pools that are exhibiting errors or are otherwise
unavailable.
Warnings about pools not using the latest on-disk format will not be included.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>sync</B>

[<I>pool ...</I>

]

<DD>

<DD>This command forces all in-core dirty data to be written to the primary
pool storage and not the ZIL. It will also update administrative
information including quota reporting. Without arguments,
<B>zpool sync</B>

will sync all pools on the system. Otherwise, it will sync only the
specified pool(s).
<DT><B>
</B>

<B></B>


<B>upgrade</B>

<DD>

<DD>Displays pools which do not have all supported features enabled and pools
formatted using a legacy ZFS version number.
These pools can continue to be used, but some features may not be available.
Use
<B>zpool upgrade -a</B>





to enable all features on all pools.
<DT><B>
</B>

<B></B>


<B>upgrade</B>

-<B>v</B>

<DD>

<DD>Displays legacy ZFS versions supported by the current software.
See
zpool-features5


for a description of feature flags features supported by the current software.
<DT><B>
</B>

<B></B>


<B>upgrade</B>

[-<B>V </B><I>version</I>



]

-<B>a | </B><I>pool </I><B>...</B>









<DD>

<DD>Enables all supported features on the given pool.
Once this is done, the pool will no longer be accessible on systems that do not
support feature flags.
See
zpool-features5


for details on compatibility with systems that support feature flags, but do not
support all features enabled on the pool.
<DL COMPACT>
<P>

<DT><B>-a</B>


<DD>
Enables all supported features on all pools.
<DT><B>-V </B><I>version</I>




<DD>
Upgrade to the specified legacy version.
If the
-<B>V</B>

flag is specified, no features will be enabled on the pool.
This option can only be used to increase the version number up to the last
supported legacy version number.
</DL>
<P>

<DT><B>
</B>

<B></B>


<B>version</B>

<DD>

<DD>Displays the software version of the
<B></B>


userland utility and the zfs kernel module.
</DL>
<P>

<A NAME="lbAN">&nbsp;</A>
<H2>EXIT STATUS</H2>

The following exit values are returned:
<DL COMPACT>
<P>

<DT><B>0</B>


<DD>
Successful completion.
<DT><B>1</B>


<DD>
An error occurred.
<DT><B>2</B>


<DD>
Invalid command line options were specified.
</DL>
<P>

<A NAME="lbAO">&nbsp;</A>
<H2>EXAMPLES</H2>

<DL COMPACT>
<P>

<DT><B>Example 1 Creating a RAID-Z Storage Pool</B>




<DD>
The following command creates a pool with a single raidz root vdev that
consists of six disks.

<PRE>
# zpool create tank raidz sda sdb sdc sdd sde sdf
</PRE>

<DT><B>Example 2 Creating a Mirrored Storage Pool</B>




<DD>
The following command creates a pool with two mirrors, where each mirror
contains two disks.

<PRE>
# zpool create tank mirror sda sdb mirror sdc sdd
</PRE>

<DT><B>Example 3 Creating a ZFS Storage Pool by Using Partitions</B>




<DD>
The following command creates an unmirrored pool using two disk partitions.

<PRE>
# zpool create tank sda1 sdb2
</PRE>

<DT><B>Example 4 Creating a ZFS Storage Pool by Using Files</B>




<DD>
The following command creates an unmirrored pool using files.
While not recommended, a pool based on files can be useful for experimental
purposes.

<PRE>
# zpool create tank /path/to/file/a /path/to/file/b
</PRE>

<DT><B>Example 5 Adding a Mirror to a ZFS Storage Pool</B>




<DD>
The following command adds two mirrored disks to the pool
<I>tank</I>

 
assuming the pool is already made up of two-way mirrors.
The additional space is immediately available to any datasets within the pool.

<PRE>
# zpool add tank mirror sda sdb
</PRE>

<DT><B>Example 6 Listing Available ZFS Storage Pools</B>




<DD>
The following command lists all available pools on the system.
In this case, the pool
<I>zion</I>

is faulted due to a missing device.
The results from this command are similar to the following:

<PRE>
# zpool list
NAME    SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
rpool  19.9G  8.43G  11.4G         -    33%    42%  1.00x  ONLINE  -
tank   61.5G  20.0G  41.5G         -    48%    32%  1.00x  ONLINE  -
zion       -      -      -         -      -      -      -  FAULTED -
</PRE>

<DT><B>Example 7 Destroying a ZFS Storage Pool</B>




<DD>
The following command destroys the pool
<I>tank</I>

and any datasets contained within.

<PRE>
# zpool destroy -f tank
</PRE>

<DT><B>Example 8 Exporting a ZFS Storage Pool</B>




<DD>
The following command exports the devices in pool
<I>tank</I>

so that they can be relocated or later imported.

<PRE>
# zpool export tank
</PRE>

<DT><B>Example 9 Importing a ZFS Storage Pool</B>




<DD>
The following command displays available pools, and then imports the pool
<I>tank</I>

for use on the system.
The results from this command are similar to the following:

<PRE>
# zpool import
  pool: tank
    id: 15451357997522795478
 state: ONLINE
action: The pool can be imported using its name or numeric identifier.
config:

        tank        ONLINE
          mirror    ONLINE
            sda     ONLINE
            sdb     ONLINE

# zpool import tank
</PRE>

<DT><B>Example 10 Upgrading All ZFS Storage Pools to the Current Version</B>




<DD>
The following command upgrades all ZFS Storage pools to the current version of
the software.

<PRE>
# zpool upgrade -a
This system is currently running ZFS version 2.
</PRE>

<DT><B>Example 11 Managing Hot Spares</B>




<DD>
The following command creates a new pool with an available hot spare:

<PRE>
# zpool create tank mirror sda sdb spare sdc
</PRE>

<P>

If one of the disks were to fail, the pool would be reduced to the degraded
state.
The failed device can be replaced using the following command:

<PRE>
# zpool replace tank sda sdd
</PRE>

<P>

Once the data has been resilvered, the spare is automatically removed and is
made available for use should another device fail.
The hot spare can be permanently removed from the pool using the following
command:

<PRE>
# zpool remove tank sdc
</PRE>

<DT><B>Example 12 Creating a ZFS Pool with Mirrored Separate Intent Logs</B>




<DD>
The following command creates a ZFS storage pool consisting of two, two-way
mirrors and mirrored log devices:

<PRE>
# zpool create pool mirror sda sdb mirror sdc sdd log mirror \
  sde sdf
</PRE>

<DT><B>Example 13 Adding Cache Devices to a ZFS Pool</B>




<DD>
The following command adds two disks for use as cache devices to a ZFS storage
pool:

<PRE>
# zpool add pool cache sdc sdd
</PRE>

<P>

Once added, the cache devices gradually fill with content from main memory.
Depending on the size of your cache devices, it could take over an hour for
them to fill.
Capacity and reads can be monitored using the
<B>iostat</B>

option as follows:

<PRE>
# zpool iostat -v pool 5
</PRE>

<DT><B>Example 14 Removing a Mirrored top-level (Log or Data) Device</B>




<DD>
The following commands remove the mirrored log device
<B>mirror-2</B>

and mirrored top-level data device
<B>mirror-1</B>

 
<P>

Given this configuration:

<PRE>
  pool: tank
 state: ONLINE
 scrub: none requested
config:

         NAME        STATE     READ WRITE CKSUM
         tank        ONLINE       0     0     0
           mirror-0  ONLINE       0     0     0
             sda     ONLINE       0     0     0
             sdb     ONLINE       0     0     0
           mirror-1  ONLINE       0     0     0
             sdc     ONLINE       0     0     0
             sdd     ONLINE       0     0     0
         logs
           mirror-2  ONLINE       0     0     0
             sde     ONLINE       0     0     0
             sdf     ONLINE       0     0     0
</PRE>

<P>

The command to remove the mirrored log
<B>mirror-2</B>

is:

<PRE>
# zpool remove tank mirror-2
</PRE>

<P>

The command to remove the mirrored data
<B>mirror-1</B>

is:

<PRE>
# zpool remove tank mirror-1
</PRE>

<DT><B>Example 15 Displaying expanded space on a device</B>




<DD>
The following command displays the detailed information for the pool
<I>data</I>

 
This pool is comprised of a single raidz vdev where one of its devices
increased its capacity by 10GB.
In this example, the pool will not be able to utilize this extra capacity until
all the devices under the raidz vdev have been expanded.

<PRE>
# zpool list -v data
NAME         SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT
data        23.9G  14.6G  9.30G         -    48%    61%  1.00x  ONLINE  -
  raidz1    23.9G  14.6G  9.30G         -    48%
    sda         -      -      -         -      -
    sdb         -      -      -       10G      -
    sdc         -      -      -         -      -
</PRE>

<DT><B>Example 16 Adding output columns</B>




<DD>
Additional columns can be added to the
<B>zpool status</B>



and
<B>zpool iostat</B>



output with
-<B>c</B>

option.

<PRE>
# zpool status -c vendor,model,size
   NAME     STATE  READ WRITE CKSUM vendor  model        size
   tank     ONLINE 0    0     0
   mirror-0 ONLINE 0    0     0
   U1       ONLINE 0    0     0     SEAGATE ST8000NM0075 7.3T
   U10      ONLINE 0    0     0     SEAGATE ST8000NM0075 7.3T
   U11      ONLINE 0    0     0     SEAGATE ST8000NM0075 7.3T
   U12      ONLINE 0    0     0     SEAGATE ST8000NM0075 7.3T
   U13      ONLINE 0    0     0     SEAGATE ST8000NM0075 7.3T
   U14      ONLINE 0    0     0     SEAGATE ST8000NM0075 7.3T

# zpool iostat -vc slaves
   capacity operations bandwidth
   pool       alloc free  read  write read  write slaves
   ---------- ----- ----- ----- ----- ----- ----- ---------
   tank       20.4G 7.23T 26    152   20.7M 21.6M
   mirror     20.4G 7.23T 26    152   20.7M 21.6M
   U1         -     -     0     31    1.46K 20.6M sdb sdff
   U10        -     -     0     1     3.77K 13.3K sdas sdgw
   U11        -     -     0     1     288K  13.3K sdat sdgx
   U12        -     -     0     1     78.4K 13.3K sdau sdgy
   U13        -     -     0     1     128K  13.3K sdav sdgz
   U14        -     -     0     1     63.2K 13.3K sdfk sdg
</PRE>

</DL>
<P>

<A NAME="lbAP">&nbsp;</A>
<H2>ENVIRONMENT VARIABLES</H2>

<DL COMPACT>
<P>

<DT><B>ZFS_ABORT</B>


<DD>
Cause
<B>zpool</B>

to dump core on exit for the purposes of running
<B>::findleaks</B>

 
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>ZPOOL_IMPORT_PATH</B>


<DD>
The search path for devices or files to use with the pool. This is a colon-separated list of directories in which
<B>zpool</B>

looks for device nodes and files.
Similar to the
-<B>d</B>

option in
<B>zpool import</B>

 
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>ZPOOL_VDEV_NAME_GUID</B>


<DD>
Cause
<B>zpool</B>

subcommands to output vdev guids by default.  This behavior is identical to the
<B>zpool status -g</B>

command line option.
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>ZPOOL_VDEV_NAME_FOLLOW_LINKS</B>


<DD>
Cause
<B>zpool</B>

subcommands to follow links for vdev names by default.  This behavior is identical to the
<B>zpool status -L</B>

command line option.
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>ZPOOL_VDEV_NAME_PATH</B>


<DD>
Cause
<B>zpool</B>

subcommands to output full vdev path names by default.  This
behavior is identical to the
<B>zpool status -p</B>

command line option.
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>ZFS_VDEV_DEVID_OPT_OUT</B>


<DD>
Older ZFS on Linux implementations had issues when attempting to display pool
config VDEV names if a
<B>devid</B>

NVP value is present in the pool's config.
<P>

For example, a pool that originated on illumos platform would have a devid
value in the config and
<B>zpool status</B>

would fail when listing the config.
This would also be true for future Linux based pools.
<P>

A pool can be stripped of any
<B>devid</B>

values on import or prevented from adding
them on
<B>zpool create</B>

or
<B>zpool add</B>

by setting
<B>ZFS_VDEV_DEVID_OPT_OUT</B>

 
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>ZPOOL_SCRIPTS_AS_ROOT</B>


<DD>
Allow a privileged user to run the
<B>zpool status/iostat</B>

with the
-<B>c</B>

option.  Normally, only unprivileged users are allowed to run
-<B>c</B>

 
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>ZPOOL_SCRIPTS_PATH</B>


<DD>
The search path for scripts when running
<B>zpool status/iostat</B>

with the
-<B>c</B>

option. This is a colon-separated list of directories and overrides the default
~/.zpool.d

and
/etc/zfs/zpool.d

search paths.
</DL>
<P>

<DL COMPACT>
<P>

<DT><B>ZPOOL_SCRIPTS_ENABLED</B>


<DD>
Allow a user to run
<B>zpool status/iostat</B>

with the
-<B>c</B>

option. If
<B>ZPOOL_SCRIPTS_ENABLED</B>

is not set, it is assumed that the user is allowed to run
<B>zpool status/iostat -c</B>

 
</DL>
<P>

<A NAME="lbAQ">&nbsp;</A>
<H2>INTERFACE STABILITY</H2>

<B>Evolving</B>

<A NAME="lbAR">&nbsp;</A>
<H2>SEE ALSO</H2>

zfs-events5,


zfs-module-parameters5,


zpool-features5,


<A HREF="../man8/zed.8.html">zed</A>(8),


<A HREF="../man8/zfs.8.html">zfs</A>(8)


<P>

</BODY>
</HTML>
