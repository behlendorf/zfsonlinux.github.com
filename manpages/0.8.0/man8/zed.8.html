<HTML><HEAD><TITLE>Manpage of ZED</TITLE>
</HEAD><BODY>
<H1>ZED</H1>
Section: System Administration Commands (8)<BR>Updated: Octember 1, 2013<BR>
<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">OPTIONS</A><DD>
<DT><A HREF="#lbAF">ZEVENTS</A><DD>
<DT><A HREF="#lbAG">CONFIGURATION</A><DD>
<DT><A HREF="#lbAH">ZEDLETS</A><DD>
<DT><A HREF="#lbAI">FILES</A><DD>
<DT><A HREF="#lbAJ">SIGNALS</A><DD>
<DT><A HREF="#lbAK">NOTES</A><DD>
<DT><A HREF="#lbAL">BUGS</A><DD>
<DT><A HREF="#lbAM">LICENSE</A><DD>
<DT><A HREF="#lbAN">SEE ALSO</A><DD>
</DL>
<HR>
<A HREF="../index.html">Return to Main Contents</A><HR>

<P>
<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

ZED - ZFS Event Daemon
<P>
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<DL COMPACT>
<DT>
<B>zed</B>


[<B>-d</B> <I>zedletdir</I>]
[<B>-f</B>]
[<B>-F</B>]
[<B>-h</B>]
[<B>-L</B>]
[<B>-M</B>]
[<B>-p</B> <I>pidfile</I>]
[<B>-P</B> <I>path</I>]
[<B>-s</B> <I>statefile</I>]
[<B>-v</B>]
[<B>-V</B>]
[<B>-Z</B>]
<P>
</DL>
<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

<P>

<B>ZED</B> (ZFS Event Daemon) monitors events generated by the ZFS kernel
<DD>module.  When a zevent (ZFS Event) is posted, <B>ZED</B> will run any ZEDLETs
(ZFS Event Daemon Linkage for Executable Tasks) that have been enabled for the
corresponding zevent class.
<P>
<A NAME="lbAE">&nbsp;</A>
<H2>OPTIONS</H2>

<DL COMPACT>
<DT><B>-h</B>

<DD>
Display a summary of the command-line options.
<DT><B>-L</B>

<DD>
Display license information.
<DT><B>-V</B>

<DD>
Display version information.
<DT><B>-v</B>

<DD>
Be verbose.
<DT><B>-f</B>

<DD>
Force the daemon to run if at all possible, disabling security checks and
throwing caution to the wind.  Not recommended for use in production.
<DT><B>-F</B>

<DD>
Run the daemon in the foreground.
<DT><B>-M</B>

<DD>
Lock all current and future pages in the virtual memory address space.
This may help the daemon remain responsive when the system is under heavy
memory pressure.
<DT><B>-Z</B>

<DD>
Zero the daemon's state, thereby allowing zevents still within the kernel
to be reprocessed.



<DT><B>-d&nbsp;</B><I>zedletdir</I>

<DD>
Read the enabled ZEDLETs from the specified directory.
<DT><B>-p&nbsp;</B><I>pidfile</I>

<DD>
Write the daemon's process ID to the specified file.
<DT><B>-P&nbsp;</B><I>path</I>

<DD>
Custom $PATH for zedlets to use.  Normally zedlets run in a locked-down
environment, with hardcoded paths to the ZFS commands ($ZFS, $ZPOOL, $ZED, ...),
and a hardcoded $PATH.  This is done for security reasons.  However, the
ZFS test suite uses a custom PATH for its ZFS commands, and passes it to zed
with -P.  In short, -P is only to be used by the ZFS test suite; never use
it in production!
<DT><B>-s&nbsp;</B><I>statefile</I>

<DD>
Write the daemon's state to the specified file.
</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>ZEVENTS</H2>

<P>

A zevent is comprised of a list of nvpairs (name/value pairs).  Each zevent
contains an EID (Event IDentifier) that uniquely identifies it throughout
the lifetime of the loaded ZFS kernel module; this EID is a monotonically
increasing integer that resets to 1 each time the kernel module is loaded.
Each zevent also contains a class string that identifies the type of event.
For brevity, a subclass string is defined that omits the leading components
of the class string.  Additional nvpairs exist to provide event details.
<P>

The kernel maintains a list of recent zevents that can be viewed (along with
their associated lists of nvpairs) using the &quot;<B>zpool events -v</B>&quot; command.
<P>
<A NAME="lbAG">&nbsp;</A>
<H2>CONFIGURATION</H2>

<P>

ZEDLETs to be invoked in response to zevents are located in the
<I>enabled-zedlets</I> directory.  These can be symlinked or copied from the
<I>installed-zedlets</I> directory; symlinks allow for automatic updates
from the installed ZEDLETs, whereas copies preserve local modifications.
As a security measure, ZEDLETs must be owned by root.  They must have
execute permissions for the user, but they must not have write permissions
for group or other.  Dotfiles are ignored.
<P>

ZEDLETs are named after the zevent class for which they should be invoked.
In particular, a ZEDLET will be invoked for a given zevent if either its
class or subclass string is a prefix of its filename (and is followed by
a non-alphabetic character).  As a special case, the prefix &quot;all&quot; matches
all zevents.  Multiple ZEDLETs may be invoked for a given zevent.
<P>
<A NAME="lbAH">&nbsp;</A>
<H2>ZEDLETS</H2>

<P>

ZEDLETs are executables invoked by the ZED in response to a given zevent.
They should be written under the presumption they can be invoked concurrently,
and they should use appropriate locking to access any shared resources.
Common variables used by ZEDLETs can be stored in the default rc file which
is sourced by scripts; these variables should be prefixed with &quot;ZED_&quot;.
<P>

The zevent nvpairs are passed to ZEDLETs as environment variables.
Each nvpair name is converted to an environment variable in the following
manner: 1) it is prefixed with &quot;ZEVENT_&quot;, 2) it is converted to uppercase,
and 3) each non-alphanumeric character is converted to an underscore.
Some additional environment variables have been defined to present certain
nvpair values in a more convenient form.  An incomplete list of zevent
environment variables is as follows:
<DL COMPACT>
<DT><B>ZEVENT_EID</B>

<DD>
The Event IDentifier.
<DT><B>ZEVENT_CLASS</B>

<DD>
The zevent class string.
<DT><B>ZEVENT_SUBCLASS</B>

<DD>
The zevent subclass string.
<DT><B>ZEVENT_TIME</B>

<DD>
The time at which the zevent was posted as
&quot;<I>seconds</I>&nbsp;<I>nanoseconds</I>&quot; since the Epoch.
<DT><B>ZEVENT_TIME_SECS</B>

<DD>
The <I>seconds</I> component of ZEVENT_TIME.
<DT><B>ZEVENT_TIME_NSECS</B>

<DD>
The <I>nanoseconds</I> component of ZEVENT_TIME.
<DT><B>ZEVENT_TIME_STRING</B>

<DD>
An almost-RFC3339-compliant string for ZEVENT_TIME.
</DL>
<P>

Additionally, the following ZED &amp; ZFS variables are defined:
<DL COMPACT>
<DT><B>ZED_PID</B>

<DD>
The daemon's process ID.
<DT><B>ZED_ZEDLET_DIR</B>

<DD>
The daemon's current <I>enabled-zedlets</I> directory.
<DT><B>ZFS_ALIAS</B>

<DD>
The ZFS alias (<I>name-version-release</I>) string used to build the daemon.
<DT><B>ZFS_VERSION</B>

<DD>
The ZFS version used to build the daemon.
<DT><B>ZFS_RELEASE</B>

<DD>
The ZFS release used to build the daemon.
</DL>
<P>

ZEDLETs may need to call other ZFS commands.  The installation paths of
the following executables are defined: <B>ZDB</B>, <B>ZED</B>, <B>ZFS</B>,
<B>ZINJECT</B>, and <B>ZPOOL</B>.  These variables can be overridden in the
rc file if needed.
<P>
<A NAME="lbAI">&nbsp;</A>
<H2>FILES</H2>




<DL COMPACT>
<DT><I>/usr/local/etc/zfs/zed.d</I>

<DD>
The default directory for enabled ZEDLETs.
<DT><I>/usr/local/etc/zfs/zed.d/zed.rc</I>

<DD>
The default rc file for common variables used by ZEDLETs.
<DT><I>/usr/local/libexec/zfs/zed.d</I>

<DD>
The default directory for installed ZEDLETs.
<DT><I>/usr/local/var/run/zed.pid</I>

<DD>
The default file containing the daemon's process ID.
<DT><I>/usr/local/var/run/zed.state</I>

<DD>
The default file containing the daemon's state.
<P>
</DL>
<A NAME="lbAJ">&nbsp;</A>
<H2>SIGNALS</H2>

<DL COMPACT>
<DT><B>HUP</B>

<DD>
Reconfigure the daemon and rescan the directory for enabled ZEDLETs.
<DT><B>TERM</B>

<DD>
Terminate the daemon.
<P>
</DL>
<A NAME="lbAK">&nbsp;</A>
<H2>NOTES</H2>

<P>

<B>ZED</B> requires root privileges.

<P>
<A NAME="lbAL">&nbsp;</A>
<H2>BUGS</H2>

<P>

Events are processed synchronously by a single thread.  This can delay the
processing of simultaneous zevents.
<P>

There is no maximum timeout for ZEDLET execution.  Consequently, a misbehaving
ZEDLET can delay the processing of subsequent zevents.
<P>

The ownership and permissions of the <I>enabled-zedlets</I> directory (along
with all parent directories) are not checked.  If any of these directories
are improperly owned or permissioned, an unprivileged user could insert a
ZEDLET to be executed as root.  The requirement that ZEDLETs be owned by
root mitigates this to some extent.
<P>

ZEDLETs are unable to return state/status information to the kernel.
<P>

Some zevent nvpair types are not handled.  These are denoted by zevent
environment variables having a &quot;_NOT_IMPLEMENTED_&quot; value.
<P>

Internationalization support via gettext has not been added.
<P>

The configuration file is not yet implemented.
<P>

The diagnosis engine is not yet implemented.
<P>
<A NAME="lbAM">&nbsp;</A>
<H2>LICENSE</H2>

<P>

<B>ZED</B> (ZFS Event Daemon) is distributed under the terms of the
Common Development and Distribution License Version 1.0 (CDDL-1.0).
<P>

Developed at Lawrence Livermore National Laboratory (LLNL-CODE-403049).
<P>
<A NAME="lbAN">&nbsp;</A>
<H2>SEE ALSO</H2>

<B><A HREF="../man8/zfs.8.html">zfs</A></B>(8),

<B><A HREF="../man8/zpool.8.html">zpool</A></B>(8)

<P>

</BODY>
</HTML>
